<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NZ Property Value Estimator</title>
    <meta name="description" content="Estimate property values and renovation potential in the New Zealand real estate market">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>

<style>
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 1rem;
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
    }

    .header {
        text-align: center;
        color: white;
        margin-bottom: 2rem;
        padding: 2rem 0;
    }

    .header h1 {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }

    .header p {
        font-size: 1.1rem;
        opacity: 0.95;
    }

    .auth-section {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .user-info {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .user-avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
    }

    .user-name {
        font-weight: 600;
        color: #333;
    }

    .auth-buttons {
        display: flex;
        gap: 1rem;
        align-items: center;
    }

    .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
    }

    .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
        background: #f3f4f6;
        color: #374151;
    }

    .btn-secondary:hover {
        background: #e5e7eb;
    }

    .main-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
    }

    @media (min-width: 1024px) {
        .main-grid {
            grid-template-columns: 1fr 1fr;
        }
    }

    .card {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    .card-header {
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 3px solid #667eea;
    }

    .card-title {
        font-size: 1.75rem;
        font-weight: bold;
        color: #1f2937;
        margin-bottom: 0.5rem;
    }

    .card-subtitle {
        color: #6b7280;
        font-size: 0.95rem;
    }

    .form-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1.25rem;
    }

    @media (min-width: 640px) {
        .form-grid {
            grid-template-columns: 1fr 1fr;
        }
    }

    .form-group {
        display: flex;
        flex-direction: column;
    }

    .form-group.full-width {
        grid-column: 1 / -1;
    }

    .form-label {
        font-size: 0.875rem;
        font-weight: 600;
        color: #374151;
        margin-bottom: 0.5rem;
    }

    .form-input, .form-select {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.2s;
        background: white;
    }

    .form-input:focus, .form-select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .renovation-item {
        background: #f9fafb;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
        transition: all 0.3s;
    }

    .renovation-item:hover {
        border-color: #667eea;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
    }

    .renovation-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.75rem;
    }

    .renovation-name {
        font-weight: 600;
        color: #1f2937;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .renovation-checkbox {
        width: 20px;
        height: 20px;
        cursor: pointer;
    }

    .renovation-cost {
        font-size: 0.875rem;
        color: #6b7280;
    }

    .renovation-details {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.5rem;
        margin-top: 0.75rem;
    }

    .renovation-details input {
        padding: 0.5rem;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        font-size: 0.875rem;
    }

    .results-section {
        margin-top: 2rem;
        padding-top: 2rem;
        border-top: 3px solid #667eea;
    }

    .results-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    @media (min-width: 640px) {
        .results-grid {
            grid-template-columns: 1fr 1fr;
        }
    }

    .result-box {
        background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
        border: 2px solid #667eea;
        border-radius: 12px;
        padding: 1.5rem;
        text-align: center;
    }

    .result-label {
        font-size: 0.875rem;
        color: #6b7280;
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        font-weight: 600;
    }

    .result-value {
        font-size: 2rem;
        font-weight: bold;
        color: #667eea;
        margin-bottom: 0.25rem;
    }

    .result-subtext {
        font-size: 0.875rem;
        color: #6b7280;
    }

    .renovation-list {
        background: #f9fafb;
        border-radius: 8px;
        padding: 1.5rem;
        margin-top: 1rem;
    }

    .renovation-list-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 0;
        border-bottom: 1px solid #e5e7eb;
    }

    .renovation-list-item:last-child {
        border-bottom: none;
    }

    .renovation-list-name {
        font-weight: 500;
        color: #374151;
    }

    .renovation-list-value {
        font-weight: 600;
        color: #667eea;
    }

    .saved-projects {
        margin-top: 1.5rem;
    }

    .project-item {
        background: #f9fafb;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 0.75rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        transition: all 0.2s;
    }

    .project-item:hover {
        border-color: #667eea;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);
    }

    .project-info {
        flex: 1;
    }

    .project-name {
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 0.25rem;
    }

    .project-date {
        font-size: 0.75rem;
        color: #6b7280;
    }

    .project-actions {
        display: flex;
        gap: 0.5rem;
    }

    .btn-small {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
    }

    .modal.show {
        display: flex;
    }

    .modal-content {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        max-width: 500px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
    }

    .modal-header {
        margin-bottom: 1.5rem;
    }

    .modal-title {
        font-size: 1.5rem;
        font-weight: bold;
        color: #1f2937;
    }

    .hidden {
        display: none !important;
    }

    .success-message {
        background: #10b981;
        color: white;
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
        text-align: center;
        font-weight: 600;
    }

    .info-box {
        background: #f0f9ff;
        border: 1px solid #bae6fd;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1.5rem;
        font-size: 0.875rem;
        color: #0c4a6e;
    }

    .region-note {
        font-size: 0.75rem;
        color: #6b7280;
        font-style: italic;
        margin-top: 0.25rem;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .fade-in {
        animation: fadeIn 0.3s ease-in;
    }

    .chart-container {
        position: relative;
        height: 400px;
        margin: 2rem 0;
        background: white;
        padding: 1rem;
        border-radius: 8px;
        border: 2px solid #e5e7eb;
    }

    .investment-section {
        background: #f0f9ff;
        border: 2px solid #bae6fd;
        border-radius: 12px;
        padding: 1.5rem;
        margin: 1.5rem 0;
    }

    .metric-highlight {
        background: linear-gradient(135deg, #10b98120 0%, #05966920 100%);
        border: 2px solid #10b981;
        border-radius: 8px;
        padding: 1rem;
        margin: 0.5rem 0;
    }
</style>

<div class="container">
    <div class="header">
        <h1>NZ Property Value Estimator</h1>
        <p>Estimate property values and renovation potential across New Zealand</p>
    </div>

    <!-- Auth Section -->
    <div class="auth-section">
        <div id="signedOutView">
            <p style="color: #6b7280; margin-right: 1rem;">Sign in with Google to save your projects and receive quotes</p>
        </div>
        <div id="signedInView" class="user-info hidden">
            <img id="userAvatar" class="user-avatar" src="" alt="User">
            <div>
                <div class="user-name" id="userName"></div>
                <div style="font-size: 0.875rem; color: #6b7280;" id="userEmail"></div>
            </div>
        </div>
        <div class="auth-buttons">
            <div id="googleSignInButton"></div>
            <button id="signOutButton" class="btn btn-secondary btn-small hidden">Sign Out</button>
        </div>
    </div>

    <div class="main-grid">
        <!-- Property Estimator Card -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Property Value Estimator</h2>
                <p class="card-subtitle">Enter property details to estimate current market value</p>
            </div>

            <div class="info-box">
                <strong>Enhanced Estimation:</strong> This tool now includes suburb-specific pricing data, ownership type adjustments, and property feature valuations for more accurate estimates. Results are based on market data and should be verified with a registered valuer or real estate professional.
            </div>

            <form id="propertyForm" class="form-grid">
                <div class="form-group">
                    <label class="form-label">Region</label>
                    <select id="region" class="form-select" required>
                        <option value="">Select Region</option>
                        <option value="auckland">Auckland</option>
                        <option value="wellington">Wellington</option>
                        <option value="christchurch">Christchurch</option>
                        <option value="hamilton">Hamilton</option>
                        <option value="tauranga">Tauranga</option>
                        <option value="dunedin">Dunedin</option>
                        <option value="palmerston-north">Palmerston North</option>
                        <option value="napier-hastings">Napier-Hastings</option>
                        <option value="nelson">Nelson</option>
                        <option value="rotorua">Rotorua</option>
                        <option value="queenstown">Queenstown</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Suburb</label>
                    <select id="suburb" class="form-select" required>
                        <option value="">Select Region First</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Property Type</label>
                    <select id="propertyType" class="form-select" required>
                        <option value="">Select Type</option>
                        <option value="house">House (Standalone)</option>
                        <option value="townhouse">Townhouse</option>
                        <option value="apartment">Apartment/Unit</option>
                        <option value="lifestyle">Lifestyle Block</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Ownership Type</label>
                    <select id="ownershipType" class="form-select" required>
                        <option value="">Select Ownership</option>
                        <option value="freehold">Freehold</option>
                        <option value="crosslease">Cross Lease</option>
                        <option value="leasehold">Leasehold</option>
                        <option value="unit-title">Unit Title</option>
                        <option value="company-share">Company Share</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Bedrooms</label>
                    <input type="number" id="bedrooms" class="form-input" min="1" max="10" placeholder="3" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Bathrooms</label>
                    <input type="number" id="bathrooms" class="form-input" min="1" max="10" step="0.5" placeholder="2" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Floor Area (m²)</label>
                    <input type="number" id="floorArea" class="form-input" min="20" placeholder="120" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Land Size (m²)</label>
                    <input type="number" id="landSize" class="form-input" min="0" placeholder="450">
                    <span class="region-note">Enter 0 for apartments</span>
                </div>

                <div class="form-group">
                    <label class="form-label">Age of Property (years)</label>
                    <input type="number" id="propertyAge" class="form-input" min="0" max="200" placeholder="15" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Condition</label>
                    <select id="condition" class="form-select" required>
                        <option value="">Select Condition</option>
                        <option value="excellent">Excellent - Recently renovated/new</option>
                        <option value="good">Good - Well maintained</option>
                        <option value="average">Average - Some wear and tear</option>
                        <option value="poor">Poor - Needs renovation</option>
                    </select>
                </div>

                <div class="form-group full-width">
                    <label class="form-label">Property Features (select all that apply)</label>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.75rem; margin-top: 0.5rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; color: #374151;">
                            <input type="checkbox" id="featureGarage" class="property-feature" value="garage">
                            <span>Garage</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; color: #374151;">
                            <input type="checkbox" id="featureCarport" class="property-feature" value="carport">
                            <span>Carport</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; color: #374151;">
                            <input type="checkbox" id="featureSolar" class="property-feature" value="solar">
                            <span>Solar System</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; color: #374151;">
                            <input type="checkbox" id="featureHeatPump" class="property-feature" value="heatpump">
                            <span>Heat Pump</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; color: #374151;">
                            <input type="checkbox" id="featurePool" class="property-feature" value="pool">
                            <span>Swimming Pool</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; color: #374151;">
                            <input type="checkbox" id="featureAirCon" class="property-feature" value="aircon">
                            <span>Air Conditioning</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; color: #374151;">
                            <input type="checkbox" id="featureAlarm" class="property-feature" value="alarm">
                            <span>Alarm System</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; color: #374151;">
                            <input type="checkbox" id="featureDeck" class="property-feature" value="deck">
                            <span>Deck/Patio</span>
                        </label>
                    </div>
                </div>

                <div class="form-group full-width">
                    <button type="submit" class="btn btn-primary">Calculate Property Value</button>
                </div>
            </form>

            <div id="propertyResults" class="results-section hidden">
                <h3 style="font-size: 1.5rem; font-weight: 600; margin-bottom: 1.5rem; color: #1f2937;">Estimated Property Value</h3>

                <div class="results-grid">
                    <div class="result-box">
                        <div class="result-label">Estimated Value</div>
                        <div class="result-value" id="estimatedValue">$0</div>
                        <div class="result-subtext">Current market estimate</div>
                    </div>

                    <div class="result-box">
                        <div class="result-label">Value Range</div>
                        <div class="result-value" id="valueRange" style="font-size: 1.25rem;">$0 - $0</div>
                        <div class="result-subtext">±10% variation</div>
                    </div>
                </div>

                <h3 style="font-size: 1.5rem; font-weight: 600; margin: 2rem 0 1.5rem; color: #1f2937;">Rental Income Estimate</h3>

                <div class="results-grid">
                    <div class="result-box">
                        <div class="result-label">Weekly Rent</div>
                        <div class="result-value" id="weeklyRent" style="color: #10b981;">$0</div>
                        <div class="result-subtext">Per week</div>
                    </div>

                    <div class="result-box">
                        <div class="result-label">Monthly Rent</div>
                        <div class="result-value" id="monthlyRent" style="color: #10b981;">$0</div>
                        <div class="result-subtext">Per month</div>
                    </div>

                    <div class="result-box">
                        <div class="result-label">Annual Rent</div>
                        <div class="result-value" id="annualRent" style="color: #10b981;">$0</div>
                        <div class="result-subtext">Per year</div>
                    </div>

                    <div class="result-box">
                        <div class="result-label">Rental Yield</div>
                        <div class="result-value" id="rentalYield" style="color: #10b981;">0%</div>
                        <div class="result-subtext">Annual return</div>
                    </div>
                </div>

                <div class="form-group">
                    <button id="savePropertyButton" class="btn btn-primary btn-small" style="width: 100%;">Save This Estimation</button>
                </div>
            </div>
        </div>

        <!-- Renovation Value-Add Calculator Card -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Renovation Value-Add Calculator</h2>
                <p class="card-subtitle">Estimate potential value increases from renovations</p>
            </div>

            <div class="info-box">
                Select the renovations you're considering. We'll estimate the cost and potential value increase for each.
            </div>

            <div id="renovationsList">
                <!-- Kitchen Renovation -->
                <div class="renovation-item">
                    <div class="renovation-header">
                        <label class="renovation-name">
                            <input type="checkbox" class="renovation-checkbox" data-renovation="kitchen">
                            Kitchen Renovation
                        </label>
                    </div>
                    <div class="renovation-cost">
                        Cost: $15,000 - $50,000 | Value Add: $12,000 - $40,000
                    </div>
                    <div class="renovation-details hidden" data-details="kitchen">
                        <input type="number" placeholder="Est. Cost ($)" data-cost="kitchen" value="25000">
                        <input type="number" placeholder="Value Add ($)" data-value="kitchen" value="20000">
                    </div>
                </div>

                <!-- Bathroom Renovation -->
                <div class="renovation-item">
                    <div class="renovation-header">
                        <label class="renovation-name">
                            <input type="checkbox" class="renovation-checkbox" data-renovation="bathroom">
                            Bathroom Renovation
                        </label>
                    </div>
                    <div class="renovation-cost">
                        Cost: $8,000 - $25,000 | Value Add: $6,000 - $20,000
                    </div>
                    <div class="renovation-details hidden" data-details="bathroom">
                        <input type="number" placeholder="Est. Cost ($)" data-cost="bathroom" value="15000">
                        <input type="number" placeholder="Value Add ($)" data-value="bathroom" value="12000">
                    </div>
                </div>

                <!-- Add Bedroom -->
                <div class="renovation-item">
                    <div class="renovation-header">
                        <label class="renovation-name">
                            <input type="checkbox" class="renovation-checkbox" data-renovation="bedroom">
                            Add a Bedroom
                        </label>
                    </div>
                    <div class="renovation-cost">
                        Cost: $30,000 - $80,000 | Value Add: $25,000 - $70,000
                    </div>
                    <div class="renovation-details hidden" data-details="bedroom">
                        <input type="number" placeholder="Est. Cost ($)" data-cost="bedroom" value="50000">
                        <input type="number" placeholder="Value Add ($)" data-value="bedroom" value="45000">
                    </div>
                </div>

                <!-- Add Bathroom -->
                <div class="renovation-item">
                    <div class="renovation-header">
                        <label class="renovation-name">
                            <input type="checkbox" class="renovation-checkbox" data-renovation="extrabathroom">
                            Add a Bathroom
                        </label>
                    </div>
                    <div class="renovation-cost">
                        Cost: $15,000 - $35,000 | Value Add: $12,000 - $30,000
                    </div>
                    <div class="renovation-details hidden" data-details="extrabathroom">
                        <input type="number" placeholder="Est. Cost ($)" data-cost="extrabathroom" value="25000">
                        <input type="number" placeholder="Value Add ($)" data-value="extrabathroom" value="20000">
                    </div>
                </div>

                <!-- Deck/Outdoor Living -->
                <div class="renovation-item">
                    <div class="renovation-header">
                        <label class="renovation-name">
                            <input type="checkbox" class="renovation-checkbox" data-renovation="deck">
                            Deck/Outdoor Living Area
                        </label>
                    </div>
                    <div class="renovation-cost">
                        Cost: $8,000 - $30,000 | Value Add: $6,000 - $25,000
                    </div>
                    <div class="renovation-details hidden" data-details="deck">
                        <input type="number" placeholder="Est. Cost ($)" data-cost="deck" value="15000">
                        <input type="number" placeholder="Value Add ($)" data-value="deck" value="12000">
                    </div>
                </div>

                <!-- Heat Pump -->
                <div class="renovation-item">
                    <div class="renovation-header">
                        <label class="renovation-name">
                            <input type="checkbox" class="renovation-checkbox" data-renovation="heatpump">
                            Heat Pump Installation
                        </label>
                    </div>
                    <div class="renovation-cost">
                        Cost: $2,000 - $6,000 | Value Add: $1,500 - $5,000
                    </div>
                    <div class="renovation-details hidden" data-details="heatpump">
                        <input type="number" placeholder="Est. Cost ($)" data-cost="heatpump" value="4000">
                        <input type="number" placeholder="Value Add ($)" data-value="heatpump" value="3000">
                    </div>
                </div>

                <!-- Insulation -->
                <div class="renovation-item">
                    <div class="renovation-header">
                        <label class="renovation-name">
                            <input type="checkbox" class="renovation-checkbox" data-renovation="insulation">
                            Insulation Upgrade (Ceiling & Floor)
                        </label>
                    </div>
                    <div class="renovation-cost">
                        Cost: $3,000 - $8,000 | Value Add: $2,500 - $7,000
                    </div>
                    <div class="renovation-details hidden" data-details="insulation">
                        <input type="number" placeholder="Est. Cost ($)" data-cost="insulation" value="5000">
                        <input type="number" placeholder="Value Add ($)" data-value="insulation" value="4000">
                    </div>
                </div>

                <!-- Solar System -->
                <div class="renovation-item">
                    <div class="renovation-header">
                        <label class="renovation-name">
                            <input type="checkbox" class="renovation-checkbox" data-renovation="solarsystem">
                            Solar System Installation
                        </label>
                    </div>
                    <div class="renovation-cost">
                        Cost: $8,000 - $15,000 | Value Add: $10,000 - $18,000
                    </div>
                    <div class="renovation-details hidden" data-details="solarsystem">
                        <input type="number" placeholder="Est. Cost ($)" data-cost="solarsystem" value="12000">
                        <input type="number" placeholder="Value Add ($)" data-value="solarsystem" value="15000">
                    </div>
                </div>

                <!-- Paint Interior -->
                <div class="renovation-item">
                    <div class="renovation-header">
                        <label class="renovation-name">
                            <input type="checkbox" class="renovation-checkbox" data-renovation="paintinterior">
                            Interior Painting
                        </label>
                    </div>
                    <div class="renovation-cost">
                        Cost: $3,000 - $10,000 | Value Add: $2,000 - $8,000
                    </div>
                    <div class="renovation-details hidden" data-details="paintinterior">
                        <input type="number" placeholder="Est. Cost ($)" data-cost="paintinterior" value="5000">
                        <input type="number" placeholder="Value Add ($)" data-value="paintinterior" value="4000">
                    </div>
                </div>

                <!-- Paint Exterior -->
                <div class="renovation-item">
                    <div class="renovation-header">
                        <label class="renovation-name">
                            <input type="checkbox" class="renovation-checkbox" data-renovation="paintexterior">
                            Exterior Painting
                        </label>
                    </div>
                    <div class="renovation-cost">
                        Cost: $5,000 - $15,000 | Value Add: $4,000 - $12,000
                    </div>
                    <div class="renovation-details hidden" data-details="paintexterior">
                        <input type="number" placeholder="Est. Cost ($)" data-cost="paintexterior" value="8000">
                        <input type="number" placeholder="Value Add ($)" data-value="paintexterior" value="6000">
                    </div>
                </div>

                <!-- Flooring -->
                <div class="renovation-item">
                    <div class="renovation-header">
                        <label class="renovation-name">
                            <input type="checkbox" class="renovation-checkbox" data-renovation="flooring">
                            New Flooring
                        </label>
                    </div>
                    <div class="renovation-cost">
                        Cost: $4,000 - $15,000 | Value Add: $3,000 - $12,000
                    </div>
                    <div class="renovation-details hidden" data-details="flooring">
                        <input type="number" placeholder="Est. Cost ($)" data-cost="flooring" value="8000">
                        <input type="number" placeholder="Value Add ($)" data-value="flooring" value="6000">
                    </div>
                </div>

                <!-- Landscaping -->
                <div class="renovation-item">
                    <div class="renovation-header">
                        <label class="renovation-name">
                            <input type="checkbox" class="renovation-checkbox" data-renovation="landscaping">
                            Landscaping
                        </label>
                    </div>
                    <div class="renovation-cost">
                        Cost: $5,000 - $20,000 | Value Add: $4,000 - $16,000
                    </div>
                    <div class="renovation-details hidden" data-details="landscaping">
                        <input type="number" placeholder="Est. Cost ($)" data-cost="landscaping" value="10000">
                        <input type="number" placeholder="Value Add ($)" data-value="landscaping" value="8000">
                    </div>
                </div>
            </div>

            <div id="renovationResults" class="results-section">
                <h3 style="font-size: 1.5rem; font-weight: 600; margin-bottom: 1.5rem; color: #1f2937;">Renovation Summary</h3>

                <div class="results-grid">
                    <div class="result-box">
                        <div class="result-label">Total Cost</div>
                        <div class="result-value" id="totalRenovationCost">$0</div>
                        <div class="result-subtext">Investment required</div>
                    </div>

                    <div class="result-box">
                        <div class="result-label">Total Value Add</div>
                        <div class="result-value" id="totalValueAdd">$0</div>
                        <div class="result-subtext">Potential increase</div>
                    </div>

                    <div class="result-box">
                        <div class="result-label">Net Gain/Loss</div>
                        <div class="result-value" id="netGain">$0</div>
                        <div class="result-subtext">Value - Cost</div>
                    </div>

                    <div class="result-box">
                        <div class="result-label">ROI</div>
                        <div class="result-value" id="roi">0%</div>
                        <div class="result-subtext">Return on investment</div>
                    </div>
                </div>

                <h3 style="font-size: 1.5rem; font-weight: 600; margin: 2rem 0 1.5rem; color: #1f2937;">Rental Impact</h3>

                <div class="results-grid">
                    <div class="result-box">
                        <div class="result-label">Weekly Rental Increase</div>
                        <div class="result-value" id="totalRentalIncrease" style="color: #10b981;">+$0/week</div>
                        <div class="result-subtext">Additional weekly income</div>
                    </div>

                    <div class="result-box">
                        <div class="result-label">Annual Rental Increase</div>
                        <div class="result-value" id="annualRentalIncrease" style="color: #10b981;">$0/year</div>
                        <div class="result-subtext">Additional annual income</div>
                    </div>
                </div>

                <div class="investment-section">
                    <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1.5rem; color: #1f2937;">Investment Analysis</h3>

                    <div class="form-grid" style="margin-bottom: 1.5rem;">
                        <div class="form-group">
                            <label class="form-label">Total Borrowing ($)</label>
                            <input type="number" id="totalBorrowing" class="form-input" placeholder="0" value="0" min="0">
                            <span class="region-note">Amount to finance renovations</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Interest Rate (%)</label>
                            <input type="number" id="interestRate" class="form-input" placeholder="6.8" value="6.8" min="0" max="20" step="0.1">
                            <span class="region-note">Annual interest rate</span>
                        </div>
                    </div>

                    <button id="calculateInvestment" class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;">Calculate Investment Returns</button>

                    <div id="investmentResults" class="hidden">
                        <div class="results-grid">
                            <div class="result-box metric-highlight">
                                <div class="result-label">10-Year ROI</div>
                                <div class="result-value" id="roi10Year" style="color: #059669;">0%</div>
                                <div class="result-subtext">Total return over 10 years</div>
                            </div>

                            <div class="result-box metric-highlight">
                                <div class="result-label">Break-Even Time</div>
                                <div class="result-value" id="breakEvenYears" style="color: #059669;">0 years</div>
                                <div class="result-subtext">Time to recover investment</div>
                            </div>

                            <div class="result-box">
                                <div class="result-label">Total Interest Paid</div>
                                <div class="result-value" id="totalInterestPaid" style="color: #ef4444;">$0</div>
                                <div class="result-subtext">Over loan term</div>
                            </div>

                            <div class="result-box">
                                <div class="result-label">Net Profit (10 Years)</div>
                                <div class="result-value" id="netProfit10Year">$0</div>
                                <div class="result-subtext">After all costs</div>
                            </div>
                        </div>

                        <h4 style="font-weight: 600; margin: 2rem 0 1rem; color: #1f2937;">10-Year Projection</h4>
                        <div class="chart-container">
                            <canvas id="chart10Year"></canvas>
                        </div>

                        <h4 style="font-weight: 600; margin: 2rem 0 1rem; color: #1f2937;">25-Year Projection</h4>
                        <div class="chart-container">
                            <canvas id="chart25Year"></canvas>
                        </div>
                    </div>
                </div>

                <div id="selectedRenovations" class="renovation-list hidden">
                    <h4 style="font-weight: 600; margin-bottom: 1rem; color: #1f2937;">Selected Renovations</h4>
                    <div id="renovationListItems"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Saved Projects Section -->
    <div id="savedProjectsSection" class="card hidden" style="margin-top: 2rem;">
        <div class="card-header">
            <h2 class="card-title">Your Saved Projects</h2>
            <p class="card-subtitle">Load or manage your saved property estimations</p>
        </div>
        <div id="savedProjectsList"></div>
    </div>

    <!-- Quote Request Section -->
    <div id="quoteSection" class="card" style="margin-top: 2rem;">
        <div class="card-header">
            <h2 class="card-title">Get Professional Quotes</h2>
            <p class="card-subtitle">Receive personalized quotes from NZ property professionals</p>
        </div>

        <div class="info-box">
            Based on your property estimation, we can connect you with trusted professionals for renovations, valuations, and property development advice.
        </div>

        <form id="quoteForm" class="form-grid">
            <div class="form-group">
                <label class="form-label">Full Name *</label>
                <input type="text" id="quoteName" class="form-input" required>
            </div>

            <div class="form-group">
                <label class="form-label">Email Address *</label>
                <input type="email" id="quoteEmail" class="form-input" required>
            </div>

            <div class="form-group">
                <label class="form-label">Phone Number *</label>
                <input type="tel" id="quotePhone" class="form-input" placeholder="021 234 5678" required>
            </div>

            <div class="form-group">
                <label class="form-label">Property Address</label>
                <input type="text" id="quoteAddress" class="form-input" placeholder="123 Main Street, Auckland">
            </div>

            <div class="form-group full-width">
                <label class="form-label">What are you interested in? *</label>
                <select id="quoteInterest" class="form-select" required>
                    <option value="">Select...</option>
                    <option value="property-valuation">Property Valuation</option>
                    <option value="renovation-quotes">Renovation Quotes</option>
                    <option value="property-development">Property Development Advice</option>
                    <option value="real-estate-advice">Real Estate Investment Advice</option>
                    <option value="all">All of the above</option>
                </select>
            </div>

            <div class="form-group full-width">
                <label class="form-label">Additional Comments</label>
                <textarea id="quoteComments" class="form-input" rows="4" placeholder="Tell us more about your project..."></textarea>
            </div>

            <div class="form-group full-width">
                <button type="submit" class="btn btn-primary">Request Quotes</button>
            </div>
        </form>

        <div id="quoteSuccess" class="success-message hidden">
            Thank you! Your quote request has been submitted. We'll be in touch shortly.
        </div>
    </div>
</div>

<!-- Save Project Modal -->
<div id="saveModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Save Project</h3>
        </div>
        <div class="form-group">
            <label class="form-label">Project Name</label>
            <input type="text" id="projectName" class="form-input" placeholder="e.g., My Auckland Property">
        </div>
        <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
            <button id="saveProjectConfirm" class="btn btn-primary">Save</button>
            <button id="saveProjectCancel" class="btn btn-secondary">Cancel</button>
        </div>
    </div>
</div>

<script>
(function() {
    'use strict';

    // Google Sign-In Configuration
    const GOOGLE_CLIENT_ID = ''; // Add your Google OAuth Client ID here

    // State management
    let currentUser = null;
    let currentPropertyData = null;
    let currentRenovationData = [];
    let savedProjects = [];

    // Region-based property value multipliers (base: Auckland = 1.0)
    const regionMultipliers = {
        'auckland': 1.0,
        'wellington': 0.85,
        'christchurch': 0.65,
        'hamilton': 0.70,
        'tauranga': 0.75,
        'dunedin': 0.55,
        'palmerston-north': 0.50,
        'napier-hastings': 0.58,
        'nelson': 0.72,
        'rotorua': 0.52,
        'queenstown': 1.15,
        'other': 0.60
    };

    // Suburb data with pricing multipliers relative to region average
    const suburbData = {
        'auckland': {
            'remuera': 1.45, 'herne-bay': 1.50, 'parnell': 1.40, 'mission-bay': 1.35,
            'ponsonby': 1.30, 'grey-lynn': 1.25, 'mt-eden': 1.28, 'epsom': 1.32,
            'devonport': 1.22, 'takapuna': 1.20, 'milford': 1.18, 'browns-bay': 1.05,
            'albany': 1.08, 'mt-albert': 1.10, 'western-springs': 1.15, 'pt-chevalier': 1.12,
            'sandringham': 1.00, 'mt-roskill': 0.95, 'avondale': 0.92, 'new-lynn': 0.90,
            'glen-eden': 0.85, 'henderson': 0.88, 'massey': 0.82, 'west-harbour': 0.87,
            'howick': 1.08, 'bucklands-beach': 1.10, 'half-moon-bay': 1.12, 'botany': 0.98,
            'pakuranga': 1.02, 'highland-park': 0.96, 'glendowie': 1.20, 'st-heliers': 1.38,
            'onehunga': 0.98, 'royal-oak': 1.02, 'greenlane': 1.05, 'ellerslie': 1.03,
            'panmure': 0.92, 'glen-innes': 0.88, 'point-england': 0.85, 'mt-wellington': 0.90,
            'mangere': 0.75, 'otara': 0.70, 'papatoetoe': 0.80, 'manurewa': 0.72,
            'papakura': 0.78, 'pukekohe': 0.82, 'waiuku': 0.75, 'drury': 0.80,
            'orewa': 0.95, 'whangaparaoa': 0.98, 'silverdale': 1.00, 'red-beach': 0.96
        },
        'wellington': {
            'oriental-bay': 1.40, 'roseneath': 1.35, 'seatoun': 1.30, 'island-bay': 1.15,
            'mt-victoria': 1.25, 'kelburn': 1.28, 'wadestown': 1.22, 'thorndon': 1.32,
            'karori': 1.10, 'northland': 1.15, 'khandallah': 1.20, 'ngaio': 1.12,
            'brooklyn': 1.08, 'kingston': 1.05, 'miramar': 1.10, 'lyall-bay': 1.12,
            'newtown': 1.00, 'mt-cook': 0.98, 'kilbirnie': 1.02, 'hataitai': 1.18,
            'johnsonville': 0.95, 'tawa': 0.90, 'porirua': 0.85, 'titahi-bay': 0.82,
            'lower-hutt': 0.88, 'upper-hutt': 0.85, 'petone': 0.92, 'eastbourne': 1.15,
            'kapiti-coast': 0.80, 'paraparaumu': 0.82, 'waikanae': 0.85, 'raumati': 0.83
        },
        'christchurch': {
            'fendalton': 1.35, 'merivale': 1.40, 'cashmere': 1.30, 'westmorland': 1.32,
            'sumner': 1.28, 'redcliffs': 1.25, 'ferrymead': 1.15, 'mt-pleasant': 1.20,
            'st-albans': 1.10, 'papanui': 1.08, 'burnside': 1.12, 'bryndwr': 1.05,
            'riccarton': 1.00, 'upper-riccarton': 1.05, 'ilam': 1.02, 'sockburn': 0.92,
            'hornby': 0.88, 'halswell': 0.95, 'templeton': 0.85, 'prebbleton': 0.90,
            'new-brighton': 0.85, 'aranui': 0.75, 'wainoni': 0.78, 'bromley': 0.80,
            'linwood': 0.88, 'woolston': 0.90, 'opawa': 1.00, 'somerfield': 1.05,
            'lyttelton': 1.10, 'diamond-harbour': 1.08, 'rolleston': 0.92, 'lincoln': 0.88
        },
        'hamilton': {
            'hamilton-east': 1.15, 'riverlea': 1.20, 'fitzroy': 1.10, 'claudelands': 1.18,
            'hillcrest': 1.12, 'chartwell': 1.08, 'rototuna': 1.05, 'flagstaff': 1.10,
            'dinsdale': 0.95, 'frankton': 1.00, 'hamilton-central': 0.98, 'western-heights': 0.92,
            'melville': 1.05, 'beerescourt': 0.88, 'fairfield': 1.02, 'enderley': 0.90,
            'huntington': 0.95, 'nawton': 0.92, 'forest-lake': 1.00, 'te-rapa': 0.85,
            'cambridge': 1.15, 'te-awamutu': 0.90, 'morrinsville': 0.85, 'matamata': 0.88
        },
        'tauranga': {
            'mt-maunganui': 1.25, 'papamoa': 1.15, 'bethlehem': 1.20, 'matua': 1.22,
            'otumoetai': 1.18, 'brookfield': 1.12, 'tauranga-central': 1.10, 'greerton': 1.00,
            'gate-pa': 1.05, 'merivale': 1.08, 'pyes-pa': 1.02, 'welcome-bay': 0.98,
            'te-puke': 0.85, 'katikati': 0.88, 'waihi-beach': 1.10, 'ohope': 1.05
        },
        'dunedin': {
            'roslyn': 1.20, 'maori-hill': 1.22, 'belleknowes': 1.15, 'wakari': 1.10,
            'helensburgh': 1.12, 'andersons-bay': 1.18, 'st-clair': 1.25, 'st-kilda': 1.15,
            'dunedin-central': 1.05, 'north-dunedin': 1.08, 'mornington': 1.10, 'kaikorai': 1.00,
            'brockville': 1.05, 'green-island': 0.92, 'mosgiel': 0.88, 'brighton': 0.95,
            'portobello': 1.12, 'warrington': 0.85, 'waikouaiti': 0.80, 'waitati': 0.85
        },
        'palmerston-north': {
            'hokowhitu': 1.15, 'takaro': 1.08, 'roslyn': 1.12, 'awapuni': 1.05,
            'palmerston-north-central': 1.00, 'terrace-end': 1.02, 'kelvin-grove': 0.98, 'milson': 1.05,
            'fitzherbert': 0.95, 'cloverlea': 0.92, 'highbury': 0.95, 'west-end': 0.90,
            'ashhurst': 0.85, 'feilding': 0.88, 'shannon': 0.80, 'foxton': 0.78
        },
        'napier-hastings': {
            'napier-hill': 1.20, 'bluff-hill': 1.25, 'hospital-hill': 1.15, 'ahuriri': 1.22,
            'westshore': 1.18, 'taradale': 1.10, 'greenmeadows': 1.08, 'napier-south': 1.00,
            'marewa': 0.98, 'onekawa': 0.95, 'maraenui': 0.85, 'tamatea': 0.92,
            'havelock-north': 1.15, 'hastings-central': 1.00, 'flaxmere': 0.80, 'camberley': 0.95
        },
        'nelson': {
            'nelson-central': 1.10, 'the-wood': 1.20, 'tahunanui': 1.15, 'washington-valley': 1.18,
            'stoke': 1.05, 'monaco': 1.08, 'richmond': 1.00, 'hope': 0.95,
            'brightwater': 0.92, 'wakefield': 0.88, 'motueka': 0.90, 'mapua': 1.05
        },
        'rotorua': {
            'rotorua-central': 1.00, 'western-heights': 0.95, 'lynmore': 1.15, 'ngongotaha': 1.08,
            'sunnybrook': 1.10, 'owhata': 0.90, 'fordlands': 0.80, 'koutu': 0.88,
            'victoria': 0.92, 'Springfield': 1.05, 'hamurana': 1.12, 'lake-okareka': 1.20
        },
        'queenstown': {
            'queenstown-hill': 1.30, 'fernhill': 1.25, 'sunshine-bay': 1.35, 'kelvin-heights': 1.40,
            'queenstown-central': 1.20, 'frankton': 1.10, 'arrowtown': 1.28, 'jacks-point': 1.45,
            'lake-hayes': 1.38, 'shotover-country': 1.22, 'wanaka': 1.25, 'albert-town': 1.15,
            'cromwell': 0.85, 'alexandra': 0.80, 'clyde': 0.88, 'glenorchy': 0.90
        },
        'other': {
            'default': 1.00
        }
    };

    // Ownership type multipliers
    const ownershipMultipliers = {
        'freehold': 1.00,
        'crosslease': 0.92,
        'leasehold': 0.70,
        'unit-title': 0.95,
        'company-share': 0.88
    };

    // Feature value additions (in dollars)
    const featureValues = {
        'garage': 15000,
        'carport': 8000,
        'solar': 12000,
        'heatpump': 5000,
        'pool': 25000,
        'aircon': 8000,
        'alarm': 3000,
        'deck': 10000
    };

    // Weekly rental adjustments for features (in dollars per week)
    const featureRentalAdjustments = {
        'garage': 20,
        'carport': 10,
        'solar': 15,  // Reduced power bills appeal to tenants
        'heatpump': 25,
        'pool': 30,
        'aircon': 15,
        'alarm': 5,
        'deck': 15
    };

    // Renovation weekly rental adjustments (in dollars per week)
    const renovationRentalAdjustments = {
        'kitchen': 40,
        'bathroom': 30,
        'bedroom': 50,  // Extra bedroom significantly increases rental
        'extrabathroom': 35,
        'deck': 15,
        'heatpump': 25,
        'insulation': 20,
        'solarsystem': 15,
        'paintinterior': 10,
        'paintexterior': 5,
        'flooring': 15,
        'landscaping': 10
    };

    // Base renovation costs and value adds (used for calculation)
    const baseRenovationData = {
        'kitchen': { cost: 25000, valueAdd: 20000 },
        'bathroom': { cost: 15000, valueAdd: 12000 },
        'bedroom': { cost: 50000, valueAdd: 45000 },
        'extrabathroom': { cost: 25000, valueAdd: 20000 },
        'deck': { cost: 15000, valueAdd: 12000 },
        'heatpump': { cost: 4000, valueAdd: 3000 },
        'insulation': { cost: 5000, valueAdd: 4000 },
        'solarsystem': { cost: 12000, valueAdd: 15000 },
        'paintinterior': { cost: 5000, valueAdd: 4000 },
        'paintexterior': { cost: 8000, valueAdd: 6000 },
        'flooring': { cost: 8000, valueAdd: 6000 },
        'landscaping': { cost: 10000, valueAdd: 8000 }
    };

    // Function to adjust renovation costs/values based on suburb
    function getSuburbAdjustedRenovation(renovation, region, suburb) {
        const base = baseRenovationData[renovation];
        if (!base) return { cost: 0, valueAdd: 0 };

        // Get suburb multiplier
        const suburbMultiplier = suburbData[region]?.[suburb] || 1.0;

        // Premium suburbs have higher costs and value adds
        // Use 80% of the suburb multiplier for renovation adjustments
        const renovationMultiplier = 0.5 + (suburbMultiplier * 0.5);

        return {
            cost: Math.round(base.cost * renovationMultiplier),
            valueAdd: Math.round(base.valueAdd * renovationMultiplier)
        };
    }

    // Base weekly rental rates by property type (Auckland baseline)
    const baseWeeklyRent = {
        'house': 650,
        'townhouse': 550,
        'apartment': 500,
        'lifestyle': 750
    };

    // Rental yield multipliers by region (compared to Auckland)
    const rentalRegionMultipliers = {
        'auckland': 1.0,
        'wellington': 1.05,
        'christchurch': 0.75,
        'hamilton': 0.70,
        'tauranga': 0.80,
        'dunedin': 0.65,
        'palmerston-north': 0.60,
        'napier-hastings': 0.65,
        'nelson': 0.75,
        'rotorua': 0.60,
        'queenstown': 1.30,
        'other': 0.65
    };

    // Property type base values (Auckland house as baseline)
    const propertyTypeValues = {
        'house': 950000,
        'townhouse': 750000,
        'apartment': 650000,
        'lifestyle': 1200000
    };

    // Initialize
    function init() {
        loadSavedProjects();
        setupEventListeners();
        initGoogleSignIn();
        calculateRenovations(); // Initialize renovation totals
    }

    // Google Sign-In
    function initGoogleSignIn() {
        if (typeof google === 'undefined') {
            console.log('Google Sign-In SDK not loaded yet, will retry...');
            setTimeout(initGoogleSignIn, 1000);
            return;
        }

        google.accounts.id.initialize({
            client_id: GOOGLE_CLIENT_ID,
            callback: handleGoogleSignIn,
            auto_select: false,
        });

        google.accounts.id.renderButton(
            document.getElementById('googleSignInButton'),
            {
                theme: 'outline',
                size: 'large',
                text: 'signin_with',
                width: 250
            }
        );

        // Check if user was previously signed in
        const savedUser = localStorage.getItem('nz_property_user');
        if (savedUser) {
            currentUser = JSON.parse(savedUser);
            updateAuthUI();
        }
    }

    function handleGoogleSignIn(response) {
        const userData = parseJwt(response.credential);
        currentUser = {
            name: userData.name,
            email: userData.email,
            picture: userData.picture
        };
        localStorage.setItem('nz_property_user', JSON.stringify(currentUser));
        updateAuthUI();
        loadSavedProjects();
    }

    function parseJwt(token) {
        const base64Url = token.split('.')[1];
        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));
        return JSON.parse(jsonPayload);
    }

    function updateAuthUI() {
        if (currentUser) {
            document.getElementById('signedOutView').classList.add('hidden');
            document.getElementById('signedInView').classList.remove('hidden');
            document.getElementById('signOutButton').classList.remove('hidden');
            document.getElementById('googleSignInButton').style.display = 'none';

            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userEmail').textContent = currentUser.email;
            document.getElementById('userAvatar').src = currentUser.picture;

            document.getElementById('savedProjectsSection').classList.remove('hidden');
        } else {
            document.getElementById('signedOutView').classList.remove('hidden');
            document.getElementById('signedInView').classList.add('hidden');
            document.getElementById('signOutButton').classList.add('hidden');
            document.getElementById('googleSignInButton').style.display = 'block';
            document.getElementById('savedProjectsSection').classList.add('hidden');
        }
    }

    // Populate suburbs based on selected region
    function populateSuburbs(region) {
        const suburbSelect = document.getElementById('suburb');
        suburbSelect.innerHTML = '<option value="">Select Suburb</option>';

        if (!region || !suburbData[region]) {
            suburbSelect.innerHTML = '<option value="">Select Region First</option>';
            return;
        }

        const suburbs = suburbData[region];
        const suburbOptions = Object.keys(suburbs).map(key => {
            const displayName = key.split('-').map(word =>
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');
            return { value: key, name: displayName };
        }).sort((a, b) => a.name.localeCompare(b.name));

        suburbOptions.forEach(suburb => {
            const option = document.createElement('option');
            option.value = suburb.value;
            option.textContent = suburb.name;
            suburbSelect.appendChild(option);
        });
    }

    // Event Listeners
    function setupEventListeners() {
        // Region change - populate suburbs and recalculate
        document.getElementById('region').addEventListener('change', function() {
            populateSuburbs(this.value);
            // Clear manually changed flags to allow suburb adjustment
            document.querySelectorAll('[data-cost], [data-value]').forEach(input => {
                delete input.dataset.manuallyChanged;
            });
            calculateRenovations();
        });

        // Suburb change - recalculate with new suburb values
        document.getElementById('suburb').addEventListener('change', function() {
            // Clear manually changed flags to allow suburb adjustment
            document.querySelectorAll('[data-cost], [data-value]').forEach(input => {
                delete input.dataset.manuallyChanged;
            });
            calculateRenovations();
        });

        // Property form submission
        document.getElementById('propertyForm').addEventListener('submit', function(e) {
            e.preventDefault();
            calculatePropertyValue();
        });

        // Renovation checkboxes
        document.querySelectorAll('.renovation-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const renovation = this.dataset.renovation;
                const details = document.querySelector(`[data-details="${renovation}"]`);
                if (this.checked) {
                    details.classList.remove('hidden');
                } else {
                    details.classList.add('hidden');
                }
                calculateRenovations();
            });
        });

        // Renovation cost/value inputs - track manual changes
        document.querySelectorAll('[data-cost], [data-value]').forEach(input => {
            input.addEventListener('input', function() {
                this.dataset.manuallyChanged = 'true';
                calculateRenovations();
            });
        });

        // Calculate investment button
        document.getElementById('calculateInvestment').addEventListener('click', function() {
            calculateInvestmentReturns();
        });

        // Save property button
        document.getElementById('savePropertyButton').addEventListener('click', function() {
            if (!currentUser) {
                alert('Please sign in with Google to save projects');
                return;
            }
            document.getElementById('saveModal').classList.add('show');
        });

        // Save modal buttons
        document.getElementById('saveProjectConfirm').addEventListener('click', saveProject);
        document.getElementById('saveProjectCancel').addEventListener('click', function() {
            document.getElementById('saveModal').classList.remove('show');
        });

        // Sign out
        document.getElementById('signOutButton').addEventListener('click', function() {
            currentUser = null;
            localStorage.removeItem('nz_property_user');
            updateAuthUI();
        });

        // Quote form
        document.getElementById('quoteForm').addEventListener('submit', submitQuoteRequest);
    }

    // Property Value Calculation
    function calculatePropertyValue() {
        const region = document.getElementById('region').value;
        const suburb = document.getElementById('suburb').value;
        const propertyType = document.getElementById('propertyType').value;
        const ownershipType = document.getElementById('ownershipType').value;
        const bedrooms = parseInt(document.getElementById('bedrooms').value);
        const bathrooms = parseFloat(document.getElementById('bathrooms').value);
        const floorArea = parseInt(document.getElementById('floorArea').value);
        const landSize = parseInt(document.getElementById('landSize').value) || 0;
        const propertyAge = parseInt(document.getElementById('propertyAge').value);
        const condition = document.getElementById('condition').value;

        if (!region || !suburb || !propertyType || !ownershipType || !bedrooms || !bathrooms || !floorArea || !condition) {
            alert('Please fill in all required fields');
            return;
        }

        // Get selected features
        const selectedFeatures = [];
        document.querySelectorAll('.property-feature:checked').forEach(feature => {
            selectedFeatures.push(feature.value);
        });

        // Base value from property type
        let baseValue = propertyTypeValues[propertyType];

        // Apply region multiplier
        baseValue *= regionMultipliers[region];

        // Apply suburb multiplier for more accurate pricing
        const suburbMultiplier = suburbData[region]?.[suburb] || 1.0;
        baseValue *= suburbMultiplier;

        // Apply ownership type multiplier
        baseValue *= ownershipMultipliers[ownershipType];

        // Adjust for bedrooms (each bedroom adds ~8%)
        const bedroomAdjustment = Math.pow(1.08, bedrooms - 3);
        baseValue *= bedroomAdjustment;

        // Adjust for bathrooms (each bathroom adds ~5%)
        const bathroomAdjustment = Math.pow(1.05, bathrooms - 2);
        baseValue *= bathroomAdjustment;

        // Adjust for floor area (per m² from base 120m²)
        const areaAdjustment = 1 + ((floorArea - 120) * 0.003);
        baseValue *= areaAdjustment;

        // Adjust for land size (for non-apartments)
        if (propertyType !== 'apartment' && landSize > 0) {
            const landAdjustment = 1 + ((landSize - 450) * 0.0005);
            baseValue *= landAdjustment;
        }

        // Age depreciation (1% per year for first 20 years, then 0.3% per year)
        let ageMultiplier = 1;
        if (propertyAge <= 20) {
            ageMultiplier = 1 - (propertyAge * 0.01);
        } else {
            ageMultiplier = 0.8 - ((propertyAge - 20) * 0.003);
        }
        baseValue *= ageMultiplier;

        // Condition multiplier
        const conditionMultipliers = {
            'excellent': 1.15,
            'good': 1.0,
            'average': 0.92,
            'poor': 0.80
        };
        baseValue *= conditionMultipliers[condition];

        // Add value for property features
        let featureValueAdd = 0;
        selectedFeatures.forEach(feature => {
            if (featureValues[feature]) {
                featureValueAdd += featureValues[feature];
            }
        });
        baseValue += featureValueAdd;

        // Ensure minimum value
        baseValue = Math.max(baseValue, 100000);

        const estimatedValue = Math.round(baseValue / 1000) * 1000; // Round to nearest $1000
        const lowerRange = Math.round(estimatedValue * 0.9 / 1000) * 1000;
        const upperRange = Math.round(estimatedValue * 1.1 / 1000) * 1000;

        // Calculate rental income
        const rentalEstimate = calculateRentalIncome(
            region, suburb, propertyType, bedrooms, bathrooms, selectedFeatures, condition
        );

        // Store current property data
        currentPropertyData = {
            region, suburb, propertyType, ownershipType, bedrooms, bathrooms, floorArea, landSize,
            propertyAge, condition, features: selectedFeatures, estimatedValue, lowerRange, upperRange,
            weeklyRent: rentalEstimate.weeklyRent,
            monthlyRent: rentalEstimate.monthlyRent,
            annualRent: rentalEstimate.annualRent
        };

        // Display results
        displayPropertyResults(estimatedValue, lowerRange, upperRange, rentalEstimate);
    }

    // Rental Income Calculation
    function calculateRentalIncome(region, suburb, propertyType, bedrooms, bathrooms, features, condition) {
        // Start with base rent for property type
        let weeklyRent = baseWeeklyRent[propertyType] || 500;

        // Apply region multiplier
        weeklyRent *= rentalRegionMultipliers[region] || 1.0;

        // Apply suburb multiplier (use 70% of the property value suburb multiplier for rental)
        const suburbMultiplier = suburbData[region]?.[suburb] || 1.0;
        const rentalSuburbMultiplier = 1 + ((suburbMultiplier - 1) * 0.7);
        weeklyRent *= rentalSuburbMultiplier;

        // Adjust for bedrooms
        if (bedrooms > 3) {
            weeklyRent += (bedrooms - 3) * 50;
        } else if (bedrooms < 3) {
            weeklyRent -= (3 - bedrooms) * 40;
        }

        // Adjust for bathrooms
        if (bathrooms > 2) {
            weeklyRent += (bathrooms - 2) * 30;
        } else if (bathrooms < 2) {
            weeklyRent -= (2 - bathrooms) * 25;
        }

        // Adjust for condition
        const conditionRentalMultipliers = {
            'excellent': 1.15,
            'good': 1.0,
            'average': 0.90,
            'poor': 0.75
        };
        weeklyRent *= conditionRentalMultipliers[condition] || 1.0;

        // Add feature adjustments
        features.forEach(feature => {
            if (featureRentalAdjustments[feature]) {
                weeklyRent += featureRentalAdjustments[feature];
            }
        });

        // Round to nearest $5
        weeklyRent = Math.round(weeklyRent / 5) * 5;

        // Calculate monthly and annual rent
        const monthlyRent = Math.round((weeklyRent * 52) / 12);
        const annualRent = weeklyRent * 52;

        return {
            weeklyRent,
            monthlyRent,
            annualRent
        };
    }

    function displayPropertyResults(estimatedValue, lowerRange, upperRange, rentalEstimate) {
        document.getElementById('estimatedValue').textContent = formatCurrency(estimatedValue);
        document.getElementById('valueRange').textContent =
            `${formatCurrency(lowerRange)} - ${formatCurrency(upperRange)}`;

        // Display rental estimates if available
        if (rentalEstimate) {
            document.getElementById('weeklyRent').textContent = formatCurrency(rentalEstimate.weeklyRent);
            document.getElementById('monthlyRent').textContent = formatCurrency(rentalEstimate.monthlyRent);
            document.getElementById('annualRent').textContent = formatCurrency(rentalEstimate.annualRent);

            // Calculate rental yield
            const rentalYield = ((rentalEstimate.annualRent / estimatedValue) * 100).toFixed(2);
            document.getElementById('rentalYield').textContent = rentalYield + '%';
        }

        document.getElementById('propertyResults').classList.remove('hidden');
        document.getElementById('propertyResults').classList.add('fade-in');
    }

    // Renovation Calculations
    function calculateRenovations() {
        // Get region and suburb for suburb-adjusted calculations
        const region = document.getElementById('region')?.value || 'auckland';
        const suburb = document.getElementById('suburb')?.value || 'sandringham';

        let totalCost = 0;
        let totalValue = 0;
        let totalRentalIncrease = 0;
        const selectedRenovations = [];

        document.querySelectorAll('.renovation-checkbox:checked').forEach(checkbox => {
            const renovation = checkbox.dataset.renovation;

            // Get suburb-adjusted values
            const adjusted = getSuburbAdjustedRenovation(renovation, region, suburb);

            // Allow user override or use adjusted values
            const costInput = document.querySelector(`[data-cost="${renovation}"]`);
            const valueInput = document.querySelector(`[data-value="${renovation}"]`);

            // Update inputs with suburb-adjusted values if they haven't been manually changed
            if (costInput && !costInput.dataset.manuallyChanged) {
                costInput.value = adjusted.cost;
            }
            if (valueInput && !valueInput.dataset.manuallyChanged) {
                valueInput.value = adjusted.valueAdd;
            }

            const cost = parseFloat(costInput?.value) || 0;
            const value = parseFloat(valueInput?.value) || 0;
            const rentalIncrease = renovationRentalAdjustments[renovation] || 0;

            totalCost += cost;
            totalValue += value;
            totalRentalIncrease += rentalIncrease;

            const name = checkbox.parentElement.textContent.trim();
            selectedRenovations.push({ name, cost, value, rentalIncrease });
        });

        currentRenovationData = selectedRenovations;

        const netGain = totalValue - totalCost;
        const roi = totalCost > 0 ? ((netGain / totalCost) * 100) : 0;

        document.getElementById('totalRenovationCost').textContent = formatCurrency(totalCost);
        document.getElementById('totalValueAdd').textContent = formatCurrency(totalValue);
        document.getElementById('netGain').textContent = formatCurrency(netGain);
        document.getElementById('netGain').style.color = netGain >= 0 ? '#10b981' : '#ef4444';
        document.getElementById('roi').textContent = roi.toFixed(1) + '%';
        document.getElementById('roi').style.color = roi >= 0 ? '#10b981' : '#ef4444';

        // Display rental increase
        document.getElementById('totalRentalIncrease').textContent = '+' + formatCurrency(totalRentalIncrease) + '/week';
        const annualRentalIncrease = totalRentalIncrease * 52;
        document.getElementById('annualRentalIncrease').textContent = formatCurrency(annualRentalIncrease) + '/year';

        // Display selected renovations
        if (selectedRenovations.length > 0) {
            document.getElementById('selectedRenovations').classList.remove('hidden');
            const listHTML = selectedRenovations.map(r => `
                <div class="renovation-list-item">
                    <span class="renovation-list-name">${r.name}</span>
                    <span class="renovation-list-value">Cost: ${formatCurrency(r.cost)} | Value: ${formatCurrency(r.value)} | Rent: +$${r.rentalIncrease}/week</span>
                </div>
            `).join('');
            document.getElementById('renovationListItems').innerHTML = listHTML;
        } else {
            document.getElementById('selectedRenovations').classList.add('hidden');
        }
    }

    // Save/Load Projects
    function saveProject() {
        if (!currentUser) {
            alert('Please sign in to save projects');
            return;
        }

        const projectName = document.getElementById('projectName').value.trim();
        if (!projectName) {
            alert('Please enter a project name');
            return;
        }

        const project = {
            id: Date.now(),
            name: projectName,
            date: new Date().toISOString(),
            propertyData: currentPropertyData,
            renovationData: currentRenovationData,
            userEmail: currentUser.email
        };

        savedProjects.push(project);
        localStorage.setItem('nz_property_projects', JSON.stringify(savedProjects));

        document.getElementById('saveModal').classList.remove('show');
        document.getElementById('projectName').value = '';

        loadSavedProjects();

        alert('Project saved successfully!');
    }

    function loadSavedProjects() {
        const stored = localStorage.getItem('nz_property_projects');
        if (stored) {
            savedProjects = JSON.parse(stored);

            // Filter to current user's projects
            if (currentUser) {
                savedProjects = savedProjects.filter(p => p.userEmail === currentUser.email);
            }

            displaySavedProjects();
        }
    }

    function displaySavedProjects() {
        if (!currentUser || savedProjects.length === 0) {
            document.getElementById('savedProjectsList').innerHTML =
                '<p style="color: #6b7280; text-align: center;">No saved projects yet</p>';
            return;
        }

        const html = savedProjects.map(project => `
            <div class="project-item" data-project-id="${project.id}">
                <div class="project-info">
                    <div class="project-name">${project.name}</div>
                    <div class="project-date">Saved: ${new Date(project.date).toLocaleDateString('en-NZ')}</div>
                </div>
                <div class="project-actions">
                    <button class="btn btn-primary btn-small load-project" data-project-id="${project.id}">Load</button>
                    <button class="btn btn-secondary btn-small delete-project" data-project-id="${project.id}">Delete</button>
                </div>
            </div>
        `).join('');

        document.getElementById('savedProjectsList').innerHTML = html;

        // Add event listeners
        document.querySelectorAll('.load-project').forEach(btn => {
            btn.addEventListener('click', function() {
                loadProject(parseInt(this.dataset.projectId));
            });
        });

        document.querySelectorAll('.delete-project').forEach(btn => {
            btn.addEventListener('click', function() {
                deleteProject(parseInt(this.dataset.projectId));
            });
        });
    }

    function loadProject(projectId) {
        const project = savedProjects.find(p => p.id === projectId);
        if (!project) return;

        // Load property data
        if (project.propertyData) {
            document.getElementById('region').value = project.propertyData.region;

            // Populate suburbs for the region, then set suburb
            populateSuburbs(project.propertyData.region);
            setTimeout(() => {
                document.getElementById('suburb').value = project.propertyData.suburb || '';
            }, 100);

            document.getElementById('propertyType').value = project.propertyData.propertyType;
            document.getElementById('ownershipType').value = project.propertyData.ownershipType || 'freehold';
            document.getElementById('bedrooms').value = project.propertyData.bedrooms;
            document.getElementById('bathrooms').value = project.propertyData.bathrooms;
            document.getElementById('floorArea').value = project.propertyData.floorArea;
            document.getElementById('landSize').value = project.propertyData.landSize;
            document.getElementById('propertyAge').value = project.propertyData.propertyAge;
            document.getElementById('condition').value = project.propertyData.condition;

            // Restore selected features
            document.querySelectorAll('.property-feature').forEach(checkbox => {
                checkbox.checked = false;
            });
            if (project.propertyData.features && Array.isArray(project.propertyData.features)) {
                project.propertyData.features.forEach(feature => {
                    const checkbox = document.querySelector(`.property-feature[value="${feature}"]`);
                    if (checkbox) {
                        checkbox.checked = true;
                    }
                });
            }

            currentPropertyData = project.propertyData;

            // Create rental estimate object from saved data if available
            const rentalEstimate = project.propertyData.weeklyRent ? {
                weeklyRent: project.propertyData.weeklyRent,
                monthlyRent: project.propertyData.monthlyRent,
                annualRent: project.propertyData.annualRent
            } : null;

            displayPropertyResults(
                project.propertyData.estimatedValue,
                project.propertyData.lowerRange,
                project.propertyData.upperRange,
                rentalEstimate
            );
        }

        // Load renovation data
        if (project.renovationData) {
            // First uncheck all
            document.querySelectorAll('.renovation-checkbox').forEach(cb => {
                cb.checked = false;
                const details = document.querySelector(`[data-details="${cb.dataset.renovation}"]`);
                details.classList.add('hidden');
            });

            // Then check and set values for saved renovations
            project.renovationData.forEach(renovation => {
                // Find checkbox by name (this is a simple match, may need improvement)
                const checkboxes = document.querySelectorAll('.renovation-checkbox');
                checkboxes.forEach(cb => {
                    if (cb.parentElement.textContent.trim() === renovation.name) {
                        cb.checked = true;
                        const type = cb.dataset.renovation;
                        const details = document.querySelector(`[data-details="${type}"]`);
                        details.classList.remove('hidden');
                        document.querySelector(`[data-cost="${type}"]`).value = renovation.cost;
                        document.querySelector(`[data-value="${type}"]`).value = renovation.value;
                    }
                });
            });

            calculateRenovations();
        }

        alert('Project loaded successfully!');
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function deleteProject(projectId) {
        if (!confirm('Are you sure you want to delete this project?')) return;

        savedProjects = savedProjects.filter(p => p.id !== projectId);
        localStorage.setItem('nz_property_projects', JSON.stringify(savedProjects));
        displaySavedProjects();
    }

    // Quote Request
    function submitQuoteRequest(e) {
        e.preventDefault();

        const formData = {
            name: document.getElementById('quoteName').value,
            email: document.getElementById('quoteEmail').value,
            phone: document.getElementById('quotePhone').value,
            address: document.getElementById('quoteAddress').value,
            interest: document.getElementById('quoteInterest').value,
            comments: document.getElementById('quoteComments').value,
            propertyData: currentPropertyData,
            renovationData: currentRenovationData,
            submittedAt: new Date().toISOString()
        };

        // Convert to FormData for webhook
        const webhookData = new FormData();
        for (const key in formData) {
            if (formData.hasOwnProperty(key)) {
                webhookData.append(key, typeof formData[key] === 'object' ? JSON.stringify(formData[key]) : formData[key]);
            }
        }

        // Submit to webhook (replace with your actual webhook URL)
        fetch('https://hooks.zapier.com/hooks/catch/25081790/urfarah/', {
            method: 'POST',
            body: webhookData
        })
        .then(() => {
            document.getElementById('quoteForm').reset();
            document.getElementById('quoteSuccess').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('quoteSuccess').classList.add('hidden');
            }, 5000);
        })
        .catch(error => {
            console.error('Error:', error);
            // Still show success message as a fallback
            document.getElementById('quoteForm').reset();
            document.getElementById('quoteSuccess').classList.remove('hidden');
        });
    }

    // Investment Analysis Calculations
    let chart10Year, chart25Year; // Store chart instances

    function calculateInvestmentReturns() {
        const totalBorrowing = parseFloat(document.getElementById('totalBorrowing').value) || 0;
        const interestRate = parseFloat(document.getElementById('interestRate').value) / 100 || 0.068;

        // Get renovation data
        const totalCost = parseFloat(document.getElementById('totalRenovationCost').textContent.replace(/[$,]/g, '')) || 0;
        const totalValueAdd = parseFloat(document.getElementById('totalValueAdd').textContent.replace(/[$,]/g, '')) || 0;
        const annualRentalIncrease = parseFloat(document.getElementById('annualRentalIncrease').textContent.replace(/[$,]/g, '').replace('/year', '')) || 0;

        if (totalCost === 0) {
            alert('Please select renovations first');
            return;
        }

        // Calculate monthly payment (interest-only for simplicity, or could do P&I)
        const monthlyInterestPayment = (totalBorrowing * interestRate) / 12;
        const annualInterestPayment = monthlyInterestPayment * 12;

        // Calculate year-by-year projections
        const projection10Year = [];
        const projection25Year = [];

        let cumulativeRentalIncome = 0;
        let cumulativeInterestPaid = 0;
        let cumulativeNetProfit = 0;

        // Assume property value appreciation of 3% per year
        const propertyAppreciationRate = 0.03;
        let propertyValueGain = 0;

        let breakEvenYear = null;

        for (let year = 1; year <= 25; year++) {
            // Annual rental income increases with inflation (2% per year)
            const yearlyRentalIncome = annualRentalIncrease * Math.pow(1.02, year - 1);
            cumulativeRentalIncome += yearlyRentalIncome;

            // Interest paid (assuming interest-only loan)
            cumulativeInterestPaid += annualInterestPayment;

            // Property value appreciation on the value add
            propertyValueGain = totalValueAdd * Math.pow(1 + propertyAppreciationRate, year);

            // Net profit = rental income + property value gain - interest paid - initial cost
            cumulativeNetProfit = cumulativeRentalIncome + propertyValueGain - cumulativeInterestPaid - totalCost;

            const yearData = {
                year: year,
                rentalIncome: cumulativeRentalIncome,
                interestPaid: cumulativeInterestPaid,
                propertyValueGain: propertyValueGain,
                netProfit: cumulativeNetProfit
            };

            if (year <= 10) {
                projection10Year.push(yearData);
            }
            projection25Year.push(yearData);

            // Check for break-even
            if (breakEvenYear === null && cumulativeNetProfit >= 0) {
                breakEvenYear = year;
            }
        }

        // Calculate 10-year ROI
        const netProfit10 = projection10Year[9].netProfit;
        const roi10Year = totalCost > 0 ? (netProfit10 / totalCost) * 100 : 0;

        // Display results
        document.getElementById('roi10Year').textContent = roi10Year.toFixed(1) + '%';
        document.getElementById('breakEvenYears').textContent = breakEvenYear ? `${breakEvenYear} years` : 'Never';
        document.getElementById('totalInterestPaid').textContent = formatCurrency(cumulativeInterestPaid);
        document.getElementById('netProfit10Year').textContent = formatCurrency(netProfit10);
        document.getElementById('netProfit10Year').style.color = netProfit10 >= 0 ? '#10b981' : '#ef4444';

        // Render charts
        renderInvestmentChart('chart10Year', projection10Year, chart10Year);
        renderInvestmentChart('chart25Year', projection25Year, chart25Year);

        document.getElementById('investmentResults').classList.remove('hidden');
    }

    function renderInvestmentChart(canvasId, projectionData, chartInstance) {
        const canvas = document.getElementById(canvasId);
        const ctx = canvas.getContext('2d');

        // Destroy existing chart if it exists
        if (chartInstance) {
            chartInstance.destroy();
        }

        const years = projectionData.map(d => `Year ${d.year}`);
        const rentalIncome = projectionData.map(d => d.rentalIncome);
        const interestPaid = projectionData.map(d => -d.interestPaid); // Negative for costs
        const netProfit = projectionData.map(d => d.netProfit);

        const newChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: years,
                datasets: [
                    {
                        label: 'Cumulative Rental Income',
                        data: rentalIncome,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: 'Cumulative Interest Paid',
                        data: interestPaid,
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: 'Net Profit',
                        data: netProfit,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: `${projectionData.length}-Year Financial Projection`,
                        font: {
                            size: 16
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                label += formatCurrency(Math.abs(context.parsed.y));
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return formatCurrency(value);
                            }
                        }
                    }
                },
                interaction: {
                    intersect: false,
                    mode: 'index'
                }
            }
        });

        // Store chart instance
        if (canvasId === 'chart10Year') {
            chart10Year = newChart;
        } else {
            chart25Year = newChart;
        }
    }

    // Utility Functions
    function formatCurrency(value) {
        return '$' + Math.round(value).toLocaleString('en-NZ');
    }

    // Initialize app
    init();
})();
</script>

</body>
</html>
