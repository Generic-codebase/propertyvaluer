<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NZ Property Value Estimator</title>
    <meta name="description" content="Estimate property values and renovation potential in the New Zealand real estate market">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>

<style>
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 1rem;
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
    }

    .header {
        text-align: center;
        color: white;
        margin-bottom: 2rem;
        padding: 2rem 0;
    }

    .header h1 {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }

    .header p {
        font-size: 1.1rem;
        opacity: 0.95;
    }

    .auth-section {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .user-info {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .user-avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
    }

    .user-name {
        font-weight: 600;
        color: #333;
    }

    .auth-buttons {
        display: flex;
        gap: 1rem;
        align-items: center;
    }

    .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
    }

    .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
        background: #f3f4f6;
        color: #374151;
    }

    .btn-secondary:hover {
        background: #e5e7eb;
    }

    .main-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
    }

    @media (min-width: 1024px) {
        .main-grid {
            grid-template-columns: 1fr 1fr;
        }
    }

    .card {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    .card-header {
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 3px solid #667eea;
    }

    .card-title {
        font-size: 1.75rem;
        font-weight: bold;
        color: #1f2937;
        margin-bottom: 0.5rem;
    }

    .card-subtitle {
        color: #6b7280;
        font-size: 0.95rem;
    }

    .form-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1.25rem;
    }

    @media (min-width: 640px) {
        .form-grid {
            grid-template-columns: 1fr 1fr;
        }
    }

    .form-group {
        display: flex;
        flex-direction: column;
    }

    .form-group.full-width {
        grid-column: 1 / -1;
    }

    .form-label {
        font-size: 0.875rem;
        font-weight: 600;
        color: #374151;
        margin-bottom: 0.5rem;
    }

    .form-input, .form-select {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.2s;
        background: white;
    }

    .form-input:focus, .form-select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .renovation-item {
        background: #f9fafb;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
        transition: all 0.3s;
    }

    .renovation-item:hover {
        border-color: #667eea;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
    }

    .renovation-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.75rem;
    }

    .renovation-name {
        font-weight: 600;
        color: #1f2937;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .renovation-checkbox {
        width: 20px;
        height: 20px;
        cursor: pointer;
    }

    .renovation-cost {
        font-size: 0.875rem;
        color: #6b7280;
    }

    .renovation-details {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.5rem;
        margin-top: 0.75rem;
    }

    .renovation-details input {
        padding: 0.5rem;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        font-size: 0.875rem;
    }

    .results-section {
        margin-top: 2rem;
        padding-top: 2rem;
        border-top: 3px solid #667eea;
    }

    .results-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    @media (min-width: 640px) {
        .results-grid {
            grid-template-columns: 1fr 1fr;
        }
    }

    .result-box {
        background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
        border: 2px solid #667eea;
        border-radius: 12px;
        padding: 1.5rem;
        text-align: center;
    }

    .result-label {
        font-size: 0.875rem;
        color: #6b7280;
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        font-weight: 600;
    }

    .result-value {
        font-size: 2rem;
        font-weight: bold;
        color: #667eea;
        margin-bottom: 0.25rem;
    }

    .result-subtext {
        font-size: 0.875rem;
        color: #6b7280;
    }

    .renovation-list {
        background: #f9fafb;
        border-radius: 8px;
        padding: 1.5rem;
        margin-top: 1rem;
    }

    .renovation-list-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 0;
        border-bottom: 1px solid #e5e7eb;
    }

    .renovation-list-item:last-child {
        border-bottom: none;
    }

    .renovation-list-name {
        font-weight: 500;
        color: #374151;
    }

    .renovation-list-value {
        font-weight: 600;
        color: #667eea;
    }

    .saved-projects {
        margin-top: 1.5rem;
    }

    .project-item {
        background: #f9fafb;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 0.75rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        transition: all 0.2s;
    }

    .project-item:hover {
        border-color: #667eea;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);
    }

    .project-info {
        flex: 1;
    }

    .project-name {
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 0.25rem;
    }

    .project-date {
        font-size: 0.75rem;
        color: #6b7280;
    }

    .project-actions {
        display: flex;
        gap: 0.5rem;
    }

    .btn-small {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
    }

    .modal.show {
        display: flex;
    }

    .modal-content {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        max-width: 500px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
    }

    .modal-header {
        margin-bottom: 1.5rem;
    }

    .modal-title {
        font-size: 1.5rem;
        font-weight: bold;
        color: #1f2937;
    }

    .hidden {
        display: none !important;
    }

    .success-message {
        background: #10b981;
        color: white;
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
        text-align: center;
        font-weight: 600;
    }

    .info-box {
        background: #f0f9ff;
        border: 1px solid #bae6fd;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1.5rem;
        font-size: 0.875rem;
        color: #0c4a6e;
    }

    .region-note {
        font-size: 0.75rem;
        color: #6b7280;
        font-style: italic;
        margin-top: 0.25rem;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .fade-in {
        animation: fadeIn 0.3s ease-in;
    }
</style>

<div class="container">
    <div class="header">
        <h1>NZ Property Value Estimator</h1>
        <p>Estimate property values and renovation potential across New Zealand</p>
    </div>

    <!-- Auth Section -->
    <div class="auth-section">
        <div id="signedOutView">
            <p style="color: #6b7280; margin-right: 1rem;">Sign in with Google to save your projects and receive quotes</p>
        </div>
        <div id="signedInView" class="user-info hidden">
            <img id="userAvatar" class="user-avatar" src="" alt="User">
            <div>
                <div class="user-name" id="userName"></div>
                <div style="font-size: 0.875rem; color: #6b7280;" id="userEmail"></div>
            </div>
        </div>
        <div class="auth-buttons">
            <div id="googleSignInButton"></div>
            <button id="signOutButton" class="btn btn-secondary btn-small hidden">Sign Out</button>
        </div>
    </div>

    <div class="main-grid">
        <!-- Property Estimator Card -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Property Value Estimator</h2>
                <p class="card-subtitle">Enter property details to estimate current market value</p>
            </div>

            <div class="info-box">
                <strong>Note:</strong> This tool provides estimates based on average market data. For accurate valuations, consult a registered valuer or real estate professional.
            </div>

            <form id="propertyForm" class="form-grid">
                <div class="form-group">
                    <label class="form-label">Region</label>
                    <select id="region" class="form-select" required>
                        <option value="">Select Region</option>
                        <option value="auckland">Auckland</option>
                        <option value="wellington">Wellington</option>
                        <option value="christchurch">Christchurch</option>
                        <option value="hamilton">Hamilton</option>
                        <option value="tauranga">Tauranga</option>
                        <option value="dunedin">Dunedin</option>
                        <option value="palmerston-north">Palmerston North</option>
                        <option value="napier-hastings">Napier-Hastings</option>
                        <option value="nelson">Nelson</option>
                        <option value="rotorua">Rotorua</option>
                        <option value="queenstown">Queenstown</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Property Type</label>
                    <select id="propertyType" class="form-select" required>
                        <option value="">Select Type</option>
                        <option value="house">House (Standalone)</option>
                        <option value="townhouse">Townhouse</option>
                        <option value="apartment">Apartment/Unit</option>
                        <option value="lifestyle">Lifestyle Block</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Bedrooms</label>
                    <input type="number" id="bedrooms" class="form-input" min="1" max="10" placeholder="3" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Bathrooms</label>
                    <input type="number" id="bathrooms" class="form-input" min="1" max="10" step="0.5" placeholder="2" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Floor Area (m²)</label>
                    <input type="number" id="floorArea" class="form-input" min="20" placeholder="120" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Land Size (m²)</label>
                    <input type="number" id="landSize" class="form-input" min="0" placeholder="450">
                    <span class="region-note">Enter 0 for apartments</span>
                </div>

                <div class="form-group">
                    <label class="form-label">Age of Property (years)</label>
                    <input type="number" id="propertyAge" class="form-input" min="0" max="200" placeholder="15" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Condition</label>
                    <select id="condition" class="form-select" required>
                        <option value="">Select Condition</option>
                        <option value="excellent">Excellent - Recently renovated/new</option>
                        <option value="good">Good - Well maintained</option>
                        <option value="average">Average - Some wear and tear</option>
                        <option value="poor">Poor - Needs renovation</option>
                    </select>
                </div>

                <div class="form-group full-width">
                    <button type="submit" class="btn btn-primary">Calculate Property Value</button>
                </div>
            </form>

            <div id="propertyResults" class="results-section hidden">
                <h3 style="font-size: 1.5rem; font-weight: 600; margin-bottom: 1.5rem; color: #1f2937;">Estimated Property Value</h3>

                <div class="results-grid">
                    <div class="result-box">
                        <div class="result-label">Estimated Value</div>
                        <div class="result-value" id="estimatedValue">$0</div>
                        <div class="result-subtext">Current market estimate</div>
                    </div>

                    <div class="result-box">
                        <div class="result-label">Value Range</div>
                        <div class="result-value" id="valueRange" style="font-size: 1.25rem;">$0 - $0</div>
                        <div class="result-subtext">±10% variation</div>
                    </div>
                </div>

                <div class="form-group">
                    <button id="savePropertyButton" class="btn btn-primary btn-small" style="width: 100%;">Save This Estimation</button>
                </div>
            </div>
        </div>

        <!-- Renovation Value-Add Calculator Card -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Renovation Value-Add Calculator</h2>
                <p class="card-subtitle">Estimate potential value increases from renovations</p>
            </div>

            <div class="info-box">
                Select the renovations you're considering. We'll estimate the cost and potential value increase for each.
            </div>

            <div id="renovationsList">
                <!-- Kitchen Renovation -->
                <div class="renovation-item">
                    <div class="renovation-header">
                        <label class="renovation-name">
                            <input type="checkbox" class="renovation-checkbox" data-renovation="kitchen">
                            Kitchen Renovation
                        </label>
                    </div>
                    <div class="renovation-cost">
                        Cost: $15,000 - $50,000 | Value Add: $12,000 - $40,000
                    </div>
                    <div class="renovation-details hidden" data-details="kitchen">
                        <input type="number" placeholder="Est. Cost ($)" data-cost="kitchen" value="25000">
                        <input type="number" placeholder="Value Add ($)" data-value="kitchen" value="20000">
                    </div>
                </div>

                <!-- Bathroom Renovation -->
                <div class="renovation-item">
                    <div class="renovation-header">
                        <label class="renovation-name">
                            <input type="checkbox" class="renovation-checkbox" data-renovation="bathroom">
                            Bathroom Renovation
                        </label>
                    </div>
                    <div class="renovation-cost">
                        Cost: $8,000 - $25,000 | Value Add: $6,000 - $20,000
                    </div>
                    <div class="renovation-details hidden" data-details="bathroom">
                        <input type="number" placeholder="Est. Cost ($)" data-cost="bathroom" value="15000">
                        <input type="number" placeholder="Value Add ($)" data-value="bathroom" value="12000">
                    </div>
                </div>

                <!-- Add Bedroom -->
                <div class="renovation-item">
                    <div class="renovation-header">
                        <label class="renovation-name">
                            <input type="checkbox" class="renovation-checkbox" data-renovation="bedroom">
                            Add a Bedroom
                        </label>
                    </div>
                    <div class="renovation-cost">
                        Cost: $30,000 - $80,000 | Value Add: $25,000 - $70,000
                    </div>
                    <div class="renovation-details hidden" data-details="bedroom">
                        <input type="number" placeholder="Est. Cost ($)" data-cost="bedroom" value="50000">
                        <input type="number" placeholder="Value Add ($)" data-value="bedroom" value="45000">
                    </div>
                </div>

                <!-- Add Bathroom -->
                <div class="renovation-item">
                    <div class="renovation-header">
                        <label class="renovation-name">
                            <input type="checkbox" class="renovation-checkbox" data-renovation="extrabathroom">
                            Add a Bathroom
                        </label>
                    </div>
                    <div class="renovation-cost">
                        Cost: $15,000 - $35,000 | Value Add: $12,000 - $30,000
                    </div>
                    <div class="renovation-details hidden" data-details="extrabathroom">
                        <input type="number" placeholder="Est. Cost ($)" data-cost="extrabathroom" value="25000">
                        <input type="number" placeholder="Value Add ($)" data-value="extrabathroom" value="20000">
                    </div>
                </div>

                <!-- Deck/Outdoor Living -->
                <div class="renovation-item">
                    <div class="renovation-header">
                        <label class="renovation-name">
                            <input type="checkbox" class="renovation-checkbox" data-renovation="deck">
                            Deck/Outdoor Living Area
                        </label>
                    </div>
                    <div class="renovation-cost">
                        Cost: $8,000 - $30,000 | Value Add: $6,000 - $25,000
                    </div>
                    <div class="renovation-details hidden" data-details="deck">
                        <input type="number" placeholder="Est. Cost ($)" data-cost="deck" value="15000">
                        <input type="number" placeholder="Value Add ($)" data-value="deck" value="12000">
                    </div>
                </div>

                <!-- Heat Pump -->
                <div class="renovation-item">
                    <div class="renovation-header">
                        <label class="renovation-name">
                            <input type="checkbox" class="renovation-checkbox" data-renovation="heatpump">
                            Heat Pump Installation
                        </label>
                    </div>
                    <div class="renovation-cost">
                        Cost: $2,000 - $6,000 | Value Add: $1,500 - $5,000
                    </div>
                    <div class="renovation-details hidden" data-details="heatpump">
                        <input type="number" placeholder="Est. Cost ($)" data-cost="heatpump" value="4000">
                        <input type="number" placeholder="Value Add ($)" data-value="heatpump" value="3000">
                    </div>
                </div>

                <!-- Insulation -->
                <div class="renovation-item">
                    <div class="renovation-header">
                        <label class="renovation-name">
                            <input type="checkbox" class="renovation-checkbox" data-renovation="insulation">
                            Insulation Upgrade (Ceiling & Floor)
                        </label>
                    </div>
                    <div class="renovation-cost">
                        Cost: $3,000 - $8,000 | Value Add: $2,500 - $7,000
                    </div>
                    <div class="renovation-details hidden" data-details="insulation">
                        <input type="number" placeholder="Est. Cost ($)" data-cost="insulation" value="5000">
                        <input type="number" placeholder="Value Add ($)" data-value="insulation" value="4000">
                    </div>
                </div>

                <!-- Paint Interior -->
                <div class="renovation-item">
                    <div class="renovation-header">
                        <label class="renovation-name">
                            <input type="checkbox" class="renovation-checkbox" data-renovation="paintinterior">
                            Interior Painting
                        </label>
                    </div>
                    <div class="renovation-cost">
                        Cost: $3,000 - $10,000 | Value Add: $2,000 - $8,000
                    </div>
                    <div class="renovation-details hidden" data-details="paintinterior">
                        <input type="number" placeholder="Est. Cost ($)" data-cost="paintinterior" value="5000">
                        <input type="number" placeholder="Value Add ($)" data-value="paintinterior" value="4000">
                    </div>
                </div>

                <!-- Paint Exterior -->
                <div class="renovation-item">
                    <div class="renovation-header">
                        <label class="renovation-name">
                            <input type="checkbox" class="renovation-checkbox" data-renovation="paintexterior">
                            Exterior Painting
                        </label>
                    </div>
                    <div class="renovation-cost">
                        Cost: $5,000 - $15,000 | Value Add: $4,000 - $12,000
                    </div>
                    <div class="renovation-details hidden" data-details="paintexterior">
                        <input type="number" placeholder="Est. Cost ($)" data-cost="paintexterior" value="8000">
                        <input type="number" placeholder="Value Add ($)" data-value="paintexterior" value="6000">
                    </div>
                </div>

                <!-- Flooring -->
                <div class="renovation-item">
                    <div class="renovation-header">
                        <label class="renovation-name">
                            <input type="checkbox" class="renovation-checkbox" data-renovation="flooring">
                            New Flooring
                        </label>
                    </div>
                    <div class="renovation-cost">
                        Cost: $4,000 - $15,000 | Value Add: $3,000 - $12,000
                    </div>
                    <div class="renovation-details hidden" data-details="flooring">
                        <input type="number" placeholder="Est. Cost ($)" data-cost="flooring" value="8000">
                        <input type="number" placeholder="Value Add ($)" data-value="flooring" value="6000">
                    </div>
                </div>

                <!-- Landscaping -->
                <div class="renovation-item">
                    <div class="renovation-header">
                        <label class="renovation-name">
                            <input type="checkbox" class="renovation-checkbox" data-renovation="landscaping">
                            Landscaping
                        </label>
                    </div>
                    <div class="renovation-cost">
                        Cost: $5,000 - $20,000 | Value Add: $4,000 - $16,000
                    </div>
                    <div class="renovation-details hidden" data-details="landscaping">
                        <input type="number" placeholder="Est. Cost ($)" data-cost="landscaping" value="10000">
                        <input type="number" placeholder="Value Add ($)" data-value="landscaping" value="8000">
                    </div>
                </div>
            </div>

            <div id="renovationResults" class="results-section">
                <h3 style="font-size: 1.5rem; font-weight: 600; margin-bottom: 1.5rem; color: #1f2937;">Renovation Summary</h3>

                <div class="results-grid">
                    <div class="result-box">
                        <div class="result-label">Total Cost</div>
                        <div class="result-value" id="totalRenovationCost">$0</div>
                        <div class="result-subtext">Investment required</div>
                    </div>

                    <div class="result-box">
                        <div class="result-label">Total Value Add</div>
                        <div class="result-value" id="totalValueAdd">$0</div>
                        <div class="result-subtext">Potential increase</div>
                    </div>

                    <div class="result-box">
                        <div class="result-label">Net Gain/Loss</div>
                        <div class="result-value" id="netGain">$0</div>
                        <div class="result-subtext">Value - Cost</div>
                    </div>

                    <div class="result-box">
                        <div class="result-label">ROI</div>
                        <div class="result-value" id="roi">0%</div>
                        <div class="result-subtext">Return on investment</div>
                    </div>
                </div>

                <div id="selectedRenovations" class="renovation-list hidden">
                    <h4 style="font-weight: 600; margin-bottom: 1rem; color: #1f2937;">Selected Renovations</h4>
                    <div id="renovationListItems"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Saved Projects Section -->
    <div id="savedProjectsSection" class="card hidden" style="margin-top: 2rem;">
        <div class="card-header">
            <h2 class="card-title">Your Saved Projects</h2>
            <p class="card-subtitle">Load or manage your saved property estimations</p>
        </div>
        <div id="savedProjectsList"></div>
    </div>

    <!-- Quote Request Section -->
    <div id="quoteSection" class="card" style="margin-top: 2rem;">
        <div class="card-header">
            <h2 class="card-title">Get Professional Quotes</h2>
            <p class="card-subtitle">Receive personalized quotes from NZ property professionals</p>
        </div>

        <div class="info-box">
            Based on your property estimation, we can connect you with trusted professionals for renovations, valuations, and property development advice.
        </div>

        <form id="quoteForm" class="form-grid">
            <div class="form-group">
                <label class="form-label">Full Name *</label>
                <input type="text" id="quoteName" class="form-input" required>
            </div>

            <div class="form-group">
                <label class="form-label">Email Address *</label>
                <input type="email" id="quoteEmail" class="form-input" required>
            </div>

            <div class="form-group">
                <label class="form-label">Phone Number *</label>
                <input type="tel" id="quotePhone" class="form-input" placeholder="021 234 5678" required>
            </div>

            <div class="form-group">
                <label class="form-label">Property Address</label>
                <input type="text" id="quoteAddress" class="form-input" placeholder="123 Main Street, Auckland">
            </div>

            <div class="form-group full-width">
                <label class="form-label">What are you interested in? *</label>
                <select id="quoteInterest" class="form-select" required>
                    <option value="">Select...</option>
                    <option value="property-valuation">Property Valuation</option>
                    <option value="renovation-quotes">Renovation Quotes</option>
                    <option value="property-development">Property Development Advice</option>
                    <option value="real-estate-advice">Real Estate Investment Advice</option>
                    <option value="all">All of the above</option>
                </select>
            </div>

            <div class="form-group full-width">
                <label class="form-label">Additional Comments</label>
                <textarea id="quoteComments" class="form-input" rows="4" placeholder="Tell us more about your project..."></textarea>
            </div>

            <div class="form-group full-width">
                <button type="submit" class="btn btn-primary">Request Quotes</button>
            </div>
        </form>

        <div id="quoteSuccess" class="success-message hidden">
            Thank you! Your quote request has been submitted. We'll be in touch shortly.
        </div>
    </div>
</div>

<!-- Save Project Modal -->
<div id="saveModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Save Project</h3>
        </div>
        <div class="form-group">
            <label class="form-label">Project Name</label>
            <input type="text" id="projectName" class="form-input" placeholder="e.g., My Auckland Property">
        </div>
        <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
            <button id="saveProjectConfirm" class="btn btn-primary">Save</button>
            <button id="saveProjectCancel" class="btn btn-secondary">Cancel</button>
        </div>
    </div>
</div>

<script>
(function() {
    'use strict';

    // Google Sign-In Configuration
    const GOOGLE_CLIENT_ID = ''; // Add your Google OAuth Client ID here

    // State management
    let currentUser = null;
    let currentPropertyData = null;
    let currentRenovationData = [];
    let savedProjects = [];

    // Region-based property value multipliers (base: Auckland = 1.0)
    const regionMultipliers = {
        'auckland': 1.0,
        'wellington': 0.85,
        'christchurch': 0.65,
        'hamilton': 0.70,
        'tauranga': 0.75,
        'dunedin': 0.55,
        'palmerston-north': 0.50,
        'napier-hastings': 0.58,
        'nelson': 0.72,
        'rotorua': 0.52,
        'queenstown': 1.15,
        'other': 0.60
    };

    // Property type base values (Auckland house as baseline)
    const propertyTypeValues = {
        'house': 950000,
        'townhouse': 750000,
        'apartment': 650000,
        'lifestyle': 1200000
    };

    // Initialize
    function init() {
        loadSavedProjects();
        setupEventListeners();
        initGoogleSignIn();
        calculateRenovations(); // Initialize renovation totals
    }

    // Google Sign-In
    function initGoogleSignIn() {
        if (typeof google === 'undefined') {
            console.log('Google Sign-In SDK not loaded yet, will retry...');
            setTimeout(initGoogleSignIn, 1000);
            return;
        }

        google.accounts.id.initialize({
            client_id: GOOGLE_CLIENT_ID,
            callback: handleGoogleSignIn,
            auto_select: false,
        });

        google.accounts.id.renderButton(
            document.getElementById('googleSignInButton'),
            {
                theme: 'outline',
                size: 'large',
                text: 'signin_with',
                width: 250
            }
        );

        // Check if user was previously signed in
        const savedUser = localStorage.getItem('nz_property_user');
        if (savedUser) {
            currentUser = JSON.parse(savedUser);
            updateAuthUI();
        }
    }

    function handleGoogleSignIn(response) {
        const userData = parseJwt(response.credential);
        currentUser = {
            name: userData.name,
            email: userData.email,
            picture: userData.picture
        };
        localStorage.setItem('nz_property_user', JSON.stringify(currentUser));
        updateAuthUI();
        loadSavedProjects();
    }

    function parseJwt(token) {
        const base64Url = token.split('.')[1];
        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));
        return JSON.parse(jsonPayload);
    }

    function updateAuthUI() {
        if (currentUser) {
            document.getElementById('signedOutView').classList.add('hidden');
            document.getElementById('signedInView').classList.remove('hidden');
            document.getElementById('signOutButton').classList.remove('hidden');
            document.getElementById('googleSignInButton').style.display = 'none';

            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userEmail').textContent = currentUser.email;
            document.getElementById('userAvatar').src = currentUser.picture;

            document.getElementById('savedProjectsSection').classList.remove('hidden');
        } else {
            document.getElementById('signedOutView').classList.remove('hidden');
            document.getElementById('signedInView').classList.add('hidden');
            document.getElementById('signOutButton').classList.add('hidden');
            document.getElementById('googleSignInButton').style.display = 'block';
            document.getElementById('savedProjectsSection').classList.add('hidden');
        }
    }

    // Event Listeners
    function setupEventListeners() {
        // Property form submission
        document.getElementById('propertyForm').addEventListener('submit', function(e) {
            e.preventDefault();
            calculatePropertyValue();
        });

        // Renovation checkboxes
        document.querySelectorAll('.renovation-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const renovation = this.dataset.renovation;
                const details = document.querySelector(`[data-details="${renovation}"]`);
                if (this.checked) {
                    details.classList.remove('hidden');
                } else {
                    details.classList.add('hidden');
                }
                calculateRenovations();
            });
        });

        // Renovation cost/value inputs
        document.querySelectorAll('[data-cost], [data-value]').forEach(input => {
            input.addEventListener('input', calculateRenovations);
        });

        // Save property button
        document.getElementById('savePropertyButton').addEventListener('click', function() {
            if (!currentUser) {
                alert('Please sign in with Google to save projects');
                return;
            }
            document.getElementById('saveModal').classList.add('show');
        });

        // Save modal buttons
        document.getElementById('saveProjectConfirm').addEventListener('click', saveProject);
        document.getElementById('saveProjectCancel').addEventListener('click', function() {
            document.getElementById('saveModal').classList.remove('show');
        });

        // Sign out
        document.getElementById('signOutButton').addEventListener('click', function() {
            currentUser = null;
            localStorage.removeItem('nz_property_user');
            updateAuthUI();
        });

        // Quote form
        document.getElementById('quoteForm').addEventListener('submit', submitQuoteRequest);
    }

    // Property Value Calculation
    function calculatePropertyValue() {
        const region = document.getElementById('region').value;
        const propertyType = document.getElementById('propertyType').value;
        const bedrooms = parseInt(document.getElementById('bedrooms').value);
        const bathrooms = parseFloat(document.getElementById('bathrooms').value);
        const floorArea = parseInt(document.getElementById('floorArea').value);
        const landSize = parseInt(document.getElementById('landSize').value) || 0;
        const propertyAge = parseInt(document.getElementById('propertyAge').value);
        const condition = document.getElementById('condition').value;

        if (!region || !propertyType || !bedrooms || !bathrooms || !floorArea || !condition) {
            alert('Please fill in all required fields');
            return;
        }

        // Base value from property type
        let baseValue = propertyTypeValues[propertyType];

        // Apply region multiplier
        baseValue *= regionMultipliers[region];

        // Adjust for bedrooms (each bedroom adds ~8%)
        const bedroomAdjustment = Math.pow(1.08, bedrooms - 3);
        baseValue *= bedroomAdjustment;

        // Adjust for bathrooms (each bathroom adds ~5%)
        const bathroomAdjustment = Math.pow(1.05, bathrooms - 2);
        baseValue *= bathroomAdjustment;

        // Adjust for floor area (per m² from base 120m²)
        const areaAdjustment = 1 + ((floorArea - 120) * 0.003);
        baseValue *= areaAdjustment;

        // Adjust for land size (for non-apartments)
        if (propertyType !== 'apartment' && landSize > 0) {
            const landAdjustment = 1 + ((landSize - 450) * 0.0005);
            baseValue *= landAdjustment;
        }

        // Age depreciation (1% per year for first 20 years, then 0.3% per year)
        let ageMultiplier = 1;
        if (propertyAge <= 20) {
            ageMultiplier = 1 - (propertyAge * 0.01);
        } else {
            ageMultiplier = 0.8 - ((propertyAge - 20) * 0.003);
        }
        baseValue *= ageMultiplier;

        // Condition multiplier
        const conditionMultipliers = {
            'excellent': 1.15,
            'good': 1.0,
            'average': 0.92,
            'poor': 0.80
        };
        baseValue *= conditionMultipliers[condition];

        // Ensure minimum value
        baseValue = Math.max(baseValue, 100000);

        const estimatedValue = Math.round(baseValue / 1000) * 1000; // Round to nearest $1000
        const lowerRange = Math.round(estimatedValue * 0.9 / 1000) * 1000;
        const upperRange = Math.round(estimatedValue * 1.1 / 1000) * 1000;

        // Store current property data
        currentPropertyData = {
            region, propertyType, bedrooms, bathrooms, floorArea, landSize, propertyAge, condition,
            estimatedValue, lowerRange, upperRange
        };

        // Display results
        displayPropertyResults(estimatedValue, lowerRange, upperRange);
    }

    function displayPropertyResults(estimatedValue, lowerRange, upperRange) {
        document.getElementById('estimatedValue').textContent = formatCurrency(estimatedValue);
        document.getElementById('valueRange').textContent =
            `${formatCurrency(lowerRange)} - ${formatCurrency(upperRange)}`;

        document.getElementById('propertyResults').classList.remove('hidden');
        document.getElementById('propertyResults').classList.add('fade-in');
    }

    // Renovation Calculations
    function calculateRenovations() {
        let totalCost = 0;
        let totalValue = 0;
        const selectedRenovations = [];

        document.querySelectorAll('.renovation-checkbox:checked').forEach(checkbox => {
            const renovation = checkbox.dataset.renovation;
            const cost = parseFloat(document.querySelector(`[data-cost="${renovation}"]`).value) || 0;
            const value = parseFloat(document.querySelector(`[data-value="${renovation}"]`).value) || 0;

            totalCost += cost;
            totalValue += value;

            const name = checkbox.parentElement.textContent.trim();
            selectedRenovations.push({ name, cost, value });
        });

        currentRenovationData = selectedRenovations;

        const netGain = totalValue - totalCost;
        const roi = totalCost > 0 ? ((netGain / totalCost) * 100) : 0;

        document.getElementById('totalRenovationCost').textContent = formatCurrency(totalCost);
        document.getElementById('totalValueAdd').textContent = formatCurrency(totalValue);
        document.getElementById('netGain').textContent = formatCurrency(netGain);
        document.getElementById('netGain').style.color = netGain >= 0 ? '#10b981' : '#ef4444';
        document.getElementById('roi').textContent = roi.toFixed(1) + '%';
        document.getElementById('roi').style.color = roi >= 0 ? '#10b981' : '#ef4444';

        // Display selected renovations
        if (selectedRenovations.length > 0) {
            document.getElementById('selectedRenovations').classList.remove('hidden');
            const listHTML = selectedRenovations.map(r => `
                <div class="renovation-list-item">
                    <span class="renovation-list-name">${r.name}</span>
                    <span class="renovation-list-value">Cost: ${formatCurrency(r.cost)} | Value: ${formatCurrency(r.value)}</span>
                </div>
            `).join('');
            document.getElementById('renovationListItems').innerHTML = listHTML;
        } else {
            document.getElementById('selectedRenovations').classList.add('hidden');
        }
    }

    // Save/Load Projects
    function saveProject() {
        if (!currentUser) {
            alert('Please sign in to save projects');
            return;
        }

        const projectName = document.getElementById('projectName').value.trim();
        if (!projectName) {
            alert('Please enter a project name');
            return;
        }

        const project = {
            id: Date.now(),
            name: projectName,
            date: new Date().toISOString(),
            propertyData: currentPropertyData,
            renovationData: currentRenovationData,
            userEmail: currentUser.email
        };

        savedProjects.push(project);
        localStorage.setItem('nz_property_projects', JSON.stringify(savedProjects));

        document.getElementById('saveModal').classList.remove('show');
        document.getElementById('projectName').value = '';

        loadSavedProjects();

        alert('Project saved successfully!');
    }

    function loadSavedProjects() {
        const stored = localStorage.getItem('nz_property_projects');
        if (stored) {
            savedProjects = JSON.parse(stored);

            // Filter to current user's projects
            if (currentUser) {
                savedProjects = savedProjects.filter(p => p.userEmail === currentUser.email);
            }

            displaySavedProjects();
        }
    }

    function displaySavedProjects() {
        if (!currentUser || savedProjects.length === 0) {
            document.getElementById('savedProjectsList').innerHTML =
                '<p style="color: #6b7280; text-align: center;">No saved projects yet</p>';
            return;
        }

        const html = savedProjects.map(project => `
            <div class="project-item" data-project-id="${project.id}">
                <div class="project-info">
                    <div class="project-name">${project.name}</div>
                    <div class="project-date">Saved: ${new Date(project.date).toLocaleDateString('en-NZ')}</div>
                </div>
                <div class="project-actions">
                    <button class="btn btn-primary btn-small load-project" data-project-id="${project.id}">Load</button>
                    <button class="btn btn-secondary btn-small delete-project" data-project-id="${project.id}">Delete</button>
                </div>
            </div>
        `).join('');

        document.getElementById('savedProjectsList').innerHTML = html;

        // Add event listeners
        document.querySelectorAll('.load-project').forEach(btn => {
            btn.addEventListener('click', function() {
                loadProject(parseInt(this.dataset.projectId));
            });
        });

        document.querySelectorAll('.delete-project').forEach(btn => {
            btn.addEventListener('click', function() {
                deleteProject(parseInt(this.dataset.projectId));
            });
        });
    }

    function loadProject(projectId) {
        const project = savedProjects.find(p => p.id === projectId);
        if (!project) return;

        // Load property data
        if (project.propertyData) {
            document.getElementById('region').value = project.propertyData.region;
            document.getElementById('propertyType').value = project.propertyData.propertyType;
            document.getElementById('bedrooms').value = project.propertyData.bedrooms;
            document.getElementById('bathrooms').value = project.propertyData.bathrooms;
            document.getElementById('floorArea').value = project.propertyData.floorArea;
            document.getElementById('landSize').value = project.propertyData.landSize;
            document.getElementById('propertyAge').value = project.propertyData.propertyAge;
            document.getElementById('condition').value = project.propertyData.condition;

            currentPropertyData = project.propertyData;
            displayPropertyResults(
                project.propertyData.estimatedValue,
                project.propertyData.lowerRange,
                project.propertyData.upperRange
            );
        }

        // Load renovation data
        if (project.renovationData) {
            // First uncheck all
            document.querySelectorAll('.renovation-checkbox').forEach(cb => {
                cb.checked = false;
                const details = document.querySelector(`[data-details="${cb.dataset.renovation}"]`);
                details.classList.add('hidden');
            });

            // Then check and set values for saved renovations
            project.renovationData.forEach(renovation => {
                // Find checkbox by name (this is a simple match, may need improvement)
                const checkboxes = document.querySelectorAll('.renovation-checkbox');
                checkboxes.forEach(cb => {
                    if (cb.parentElement.textContent.trim() === renovation.name) {
                        cb.checked = true;
                        const type = cb.dataset.renovation;
                        const details = document.querySelector(`[data-details="${type}"]`);
                        details.classList.remove('hidden');
                        document.querySelector(`[data-cost="${type}"]`).value = renovation.cost;
                        document.querySelector(`[data-value="${type}"]`).value = renovation.value;
                    }
                });
            });

            calculateRenovations();
        }

        alert('Project loaded successfully!');
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function deleteProject(projectId) {
        if (!confirm('Are you sure you want to delete this project?')) return;

        savedProjects = savedProjects.filter(p => p.id !== projectId);
        localStorage.setItem('nz_property_projects', JSON.stringify(savedProjects));
        displaySavedProjects();
    }

    // Quote Request
    function submitQuoteRequest(e) {
        e.preventDefault();

        const formData = {
            name: document.getElementById('quoteName').value,
            email: document.getElementById('quoteEmail').value,
            phone: document.getElementById('quotePhone').value,
            address: document.getElementById('quoteAddress').value,
            interest: document.getElementById('quoteInterest').value,
            comments: document.getElementById('quoteComments').value,
            propertyData: currentPropertyData,
            renovationData: currentRenovationData,
            submittedAt: new Date().toISOString()
        };

        // Convert to FormData for webhook
        const webhookData = new FormData();
        for (const key in formData) {
            if (formData.hasOwnProperty(key)) {
                webhookData.append(key, typeof formData[key] === 'object' ? JSON.stringify(formData[key]) : formData[key]);
            }
        }

        // Submit to webhook (replace with your actual webhook URL)
        fetch('https://hooks.zapier.com/hooks/catch/25081790/urfarah/', {
            method: 'POST',
            body: webhookData
        })
        .then(() => {
            document.getElementById('quoteForm').reset();
            document.getElementById('quoteSuccess').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('quoteSuccess').classList.add('hidden');
            }, 5000);
        })
        .catch(error => {
            console.error('Error:', error);
            // Still show success message as a fallback
            document.getElementById('quoteForm').reset();
            document.getElementById('quoteSuccess').classList.remove('hidden');
        });
    }

    // Utility Functions
    function formatCurrency(value) {
        return '$' + Math.round(value).toLocaleString('en-NZ');
    }

    // Initialize app
    init();
})();
</script>

</body>
</html>
